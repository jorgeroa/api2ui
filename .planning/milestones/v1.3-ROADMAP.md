# Milestone v1.3: Smart Default Selection

**Status:** SHIPPED 2026-02-09
**Phases:** 12-16
**Total Plans:** 13

## Overview

Make the rendering engine smarter about picking default components through semantic field analysis and intelligent component selection.

## Phases

### Phase 12: Core Semantic Detection
**Goal**: Engine accurately classifies common field patterns and assigns semantic meaning
**Dependencies**: None (foundation phase)
**Requirements**: SEM-01, SEM-02, SEM-03, SEM-04
**Plans**: 3 plans
- [x] 12-01-PLAN.md -- Foundation types, confidence scoring, memoization cache, schema extension
- [x] 12-02-PLAN.md -- Pattern library (22 patterns) and detection engine
- [x] 12-03-PLAN.md -- Comprehensive tests and validation (98 tests)

**Success Criteria:**
1. Pattern library detects 20-30 common field types (reviews, images, price, rating, status, tags, specifications, etc.)
2. Multi-signal detection validates name + type + values before HIGH confidence classification
3. OpenAPI hints (description, format, title) successfully inform semantic classification when present
4. Confidence scoring determines fallback behavior: >=75% confidence applies smart default, <75% falls back to type-based default
5. Classification runs once per API response with <100ms overhead

### Phase 13: Field Importance & Grouping Analysis
**Goal**: System identifies primary fields, de-emphasizes metadata, and detects logical groupings
**Dependencies**: Phase 12 (semantic detection)
**Requirements**: SEM-05, IMP-01, IMP-02, IMP-03, IMP-04, GRP-01, GRP-04, INT-02, INT-03, INT-04
**Plans**: 2 plans
- [x] 13-01-PLAN.md -- Foundation types, config, importance scoring algorithm with tests
- [x] 13-02-PLAN.md -- Grouping detection (prefix + semantic clustering) with public API

**Success Criteria:**
1. Primary fields (name, title, headline) automatically detected and flagged for prominent display
2. Metadata fields (IDs, timestamps, internal fields) automatically detected and flagged for de-emphasis
3. Importance scoring algorithm ranks fields using: name pattern (40%), visual richness (25%), data presence (20%), position (15%)
4. Prefix-based grouping detects common patterns (billing*, shipping*, contact*) and creates section suggestions
5. Semantic clustering groups related fields (email + phone + address -> "Contact") even without shared prefix
6. Feature flag enables/disables smart defaults with kill switch
7. v1.2 configurations preserved during upgrade through config versioning
8. Analysis metadata cached in appStore with <100ms overhead per API response
9. User overrides in configStore always take precedence over smart defaults

### Phase 14: Smart Component Selection
**Goal**: Arrays and objects render with context-appropriate components based on semantic analysis
**Dependencies**: Phase 13 (field importance & grouping)
**Requirements**: ARR-01, ARR-02, ARR-03, ARR-04, ARR-05, ARR-06, INT-01, INT-05
**Plans**: 3 plans
- [x] 14-01-PLAN.md -- Selection service foundation with heuristics and tests
- [x] 14-02-PLAN.md -- DynamicRenderer integration and CardListRenderer tier filtering
- [x] 14-03-PLAN.md -- Gap closure: Wire analysis pipeline and populate cache

**Success Criteria:**
1. Arrays with review/comment semantics default to card layout instead of table
2. Arrays with specification/attribute semantics default to key-value pairs
3. Arrays of image URLs default to gallery/grid view
4. Table vs cards heuristic applies: <8 fields + rich content -> cards; 10+ fields -> table
5. Arrays with rating + comment fields render as cards with star rating components
6. Arrays with date/timestamp progression render as timeline view
7. Smart defaults integrate with DynamicRenderer without breaking v1.2 behavior
8. Component switcher continues to work for user overrides (INT-05)
9. Analysis falls back to type-based defaults when confidence <75%

### Phase 14.1: Smart Object & Primitive Selection (INSERTED)
**Goal**: Objects and primitive arrays render with context-appropriate components based on semantic analysis
**Dependencies**: Phase 14 (smart component selection)
**Plans**: 2 plans
- [x] 14.1-01-PLAN.md -- Object & primitive array selection heuristics (TDD)
- [x] 14.1-02-PLAN.md -- useSchemaAnalysis integration for objects & primitive arrays

**Success Criteria:**
1. Objects with profile-like semantics (name + email/phone/address) default to hero (Profile) instead of detail
2. Objects with many nested objects/arrays default to tabs instead of detail
3. Objects with clear primary content + metadata split default to split view
4. Primitive arrays with short enum-like values default to chips
5. Smart defaults integrate with existing useSchemaAnalysis hook and analysis cache
6. User overrides via component switcher still take precedence
7. Fallback to detail (objects) or primitive-list (arrays) when confidence <75%

### Phase 15: Smart Grouping & Visual Hierarchy
**Goal**: Detail views organize into visual sections with hero layout and accordion-based grouping
**Dependencies**: Phase 14.1 (smart object & primitive selection)
**Requirements**: IMP-05, GRP-02, GRP-03, GRP-05, GRP-06
**Plans**: 2 plans
- [x] 15-01-PLAN.md -- Grouping cache + shared FieldRow with visual hierarchy
- [x] 15-02-PLAN.md -- Grouped detail view with accordions, Hero+Overview+Sections layout, escape hatch

**Success Criteria:**
1. Detail views apply visual hierarchy with primary/secondary/tertiary styling based on importance scores
2. Sections use vertical accordions (not horizontal tabs) when >8 fields with clear clusters
3. "Show all (ungrouped)" escape hatch always available for flat view
4. Detail views use Hero + Overview + Sections layout pattern when appropriate
5. Maximum two-level grouping enforced to prevent over-nesting
6. Grouping only applies when beneficial: >8 total fields AND clear semantic clusters AND no tab with <3 fields

### Phase 16: Context-Aware Components
**Goal**: Specialized components render for detected semantic types with proper formatting
**Dependencies**: Phase 15 (smart grouping)
**Requirements**: CTX-01, CTX-02, CTX-03, CTX-04, CTX-05
**Plans**: 2 plans
- [x] 16-01-PLAN.md -- Semantic components (StatusBadge, StarRating, CurrencyValue, FormattedDate, TagChips) + Badge variants
- [x] 16-02-PLAN.md -- PrimitiveRenderer + ChipsRenderer integration with semantic-aware rendering

**Success Criteria:**
1. Status/state fields render as colored badges with appropriate color semantics
2. Tags/categories arrays render as tag chips (pill-shaped labels)
3. Rating fields render as star rating display components
4. Price fields render with currency formatting using Intl.NumberFormat
5. Date fields render with formatted display with localization
6. Context-aware components integrate with existing component switcher
7. Components degrade gracefully when semantic detection has low confidence

---

## Milestone Summary

**Decimal Phases:**
- Phase 14.1: Smart Object & Primitive Selection (inserted after Phase 14 to extend heuristics to objects and primitive arrays)

**Key Decisions:**
- Zero-dependency heuristics over ML/NLP libraries for semantic detection
- Confidence threshold at 75% for smart default activation
- Importance scoring: name pattern (40%), visual richness (25%), data presence (20%), position (15%)
- Accordions over tabs for field grouping (27% overlooked rate vs 8%)
- Absolute-only date formatting (no relative dates per user decision)
- Three-tier precedence: user override > smart default > type-based fallback

**Issues Resolved:**
- Path normalization for indexed vs generic cache paths
- Heuristic priority ordering (specific before general patterns)
- TypeScript strict-mode build errors in semantic rendering pipeline
- Profile detection field-name fallback for root objects
- Smart defaults for drilled-down array items

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- CurrencyValue helper uses hardcoded currency field names (currency_code, currency, currency_id)
- PrimitiveRenderer has some inline duplicate rendering logic for precedence clarity

---

_For current project status, see .planning/ROADMAP.md_
