# Milestone v0.4: API Authentication

**Status:** SHIPPED 2026-02-10
**Phases:** 17-21
**Total Plans:** 9

## Overview

Enable api2ui to work with protected APIs by adding authentication support. Users configure credentials (API Key, Bearer Token, Basic Auth, Query Parameter) through a dedicated UI, and the fetch layer injects them into requests automatically. OpenAPI specs auto-detect auth requirements, and 401/403 errors prompt users to configure credentials. Zero new dependencies — all native browser APIs.

## Phases

### Phase 17: Auth Store & Error Foundation
**Goal**: Credential storage infrastructure and error types ready for fetch integration
**Depends on**: Nothing (foundation phase)
**Requirements**: AUTH-01, AUTH-02, AUTH-03, FETCH-06
**Plans**: 2 plans
- [x] 17-01-PLAN.md — Auth credential types and AuthError class
- [x] 17-02-PLAN.md — Auth store with sessionStorage and ErrorDisplay integration

**Success Criteria:**
1. Zustand auth store persists credentials to sessionStorage (cleared on tab close)
2. Credentials are scoped per API by base URL (`new URL(url).origin`)
3. Store supports all 4 auth types with proper TypeScript types
4. AuthError type distinguishes 401/403 from other error kinds
5. Existing error handling continues working unchanged

### Phase 18: Fetch Integration
**Goal**: Authenticated requests work end-to-end for all 4 auth types with zero regression on public APIs
**Depends on**: Phase 17
**Requirements**: FETCH-01, FETCH-02, FETCH-03, FETCH-04, FETCH-05, FETCH-07
**Plans**: 2 plans
- [x] 18-01-PLAN.md — TDD: fetchWithAuth wrapper with credential injection for all 4 auth types
- [x] 18-02-PLAN.md — Integration: wire fetchWithAuth into useAPIFetch hook

**Success Criteria:**
1. `fetchWithAuth` injects Bearer Token as `Authorization: Bearer <token>` header
2. `fetchWithAuth` injects Basic Auth as `Authorization: Basic <base64>` header
3. `fetchWithAuth` injects API Key as configurable custom header
4. `fetchWithAuth` appends Query Parameter to URL
5. 401/403 responses throw AuthError with status distinction
6. APIs without credentials configured continue working identically to v0.3

### Phase 19: Auth Configuration UI
**Goal**: Users can configure, view, and clear authentication credentials through a dedicated UI
**Depends on**: Phase 18
**Requirements**: UI-01, UI-02, UI-03, UI-04, UI-05, AUTH-04, AUTH-05
**Plans**: 2 plans
- [x] 19-01-PLAN.md — Auth UI components (LockIcon, AuthTypeSelector, CredentialForm, AuthErrorDisplay, AuthPanel)
- [x] 19-02-PLAN.md — Wire auth panel into URLInput and add auth error auto-expansion

**Success Criteria:**
1. "Authorize" button accessible from the config/settings area
2. Auth type selector lets user choose between API Key, Bearer, Basic Auth, Query Parameter
3. Form fields adapt to selected auth type (token, username/password, header name + value, param name + value)
4. Lock indicator shows current auth state (no auth / active / failed)
5. Credential values masked in UI (password input type)
6. "Clear" button removes credentials for current API
7. Auth error display shows contextual guidance (401 vs 403)

### Phase 20: OpenAPI Auto-Detection
**Goal**: OpenAPI specs automatically detect and pre-populate authentication requirements
**Depends on**: Phase 19
**Requirements**: SPEC-01, SPEC-02, SPEC-03, SPEC-04
**Plans**: 2 plans
- [x] 20-01-PLAN.md — TDD: Security scheme extraction and mapping (parser + mapper + tests)
- [x] 20-02-PLAN.md — Wire detected auth into AuthPanel for pre-population and warnings

**Success Criteria:**
1. Parser extracts `components.securitySchemes` from OpenAPI 3.x specs
2. Detected schemes map to api2ui auth types (apiKey→API Key, http:bearer→Bearer, http:basic→Basic)
3. Auth panel pre-populates type and metadata (header name, param name) from spec
4. Unsupported schemes (OAuth 2.0, OpenID Connect) show warning instead of crashing

### Phase 21: Smart Error UX
**Goal**: Authentication errors guide users to fix issues with contextual prompts and clear messaging
**Depends on**: Phase 20
**Requirements**: ERR-01, ERR-02, ERR-03
**Plans**: 1 plan
- [x] 21-01-PLAN.md — Enhance AuthErrorDisplay with action button, improve 401/403 messaging, thread callback

**Success Criteria:**
1. 401 responses trigger inline prompt: "This API requires authentication. Configure now?"
2. 403 responses show distinct message: "Credentials valid but insufficient permissions"
3. No auto-retry on auth failures (user must manually reconfigure and retry)
4. Error prompt includes direct link/button to open auth panel

---

## Milestone Summary

**Key Decisions:**
- Session storage for secrets, localStorage for config shape — balances security with UX
- Per-API auth scope by base URL origin — simpler than per-endpoint, covers majority of use cases
- Zero new dependencies — all auth implemented with native browser APIs (btoa, URLSearchParams, fetch headers)
- shadcn Button for action buttons — consistent with existing UI component library

**Issues Resolved:**
- Sidebar layout missing detectedAuth prop (fixed in commit 190d8c1)
- Pre-existing TypeScript errors in parser.ts (fixed during Phase 21 execution)

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- isAuthConfigured() and maskCredential() exported but unused — utility functions for future use

---

_For current project status, see .planning/ROADMAP.md_
