---
phase: 05-smart-visual-defaults
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/renderers/DetailRenderer.tsx
autonomous: true

must_haves:
  truths:
    - "Primary fields (name/title/label) render with larger/bolder typography than secondary fields"
    - "Detail views render image fields as full-width images instead of truncated text"
    - "Broken images in detail view hide gracefully"
    - "Typography hierarchy is visible in both View and Configure modes"
  artifacts:
    - path: "src/components/renderers/DetailRenderer.tsx"
      provides: "Typography hierarchy and full-width image rendering"
      contains: "isPrimaryField"
  key_links:
    - from: "src/components/renderers/DetailRenderer.tsx"
      to: "src/utils/imageDetection.ts"
      via: "import { isImageUrl }"
      pattern: "import.*isImageUrl.*imageDetection"
---

<objective>
Enhance DetailRenderer with typography hierarchy that visually distinguishes primary fields (name, title, label) from secondary data, and render image fields as prominent full-width images.

Purpose: Detail views are where users examine individual records — typography hierarchy guides the eye to the most important information, and full-width images make visual data immediately impactful.
Output: DetailRenderer with primary/secondary typography and full-width image rendering.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-smart-visual-defaults/05-01-SUMMARY.md
@src/components/renderers/DetailRenderer.tsx
@src/components/renderers/PrimitiveRenderer.tsx
@src/utils/imageDetection.ts
@src/types/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add full-width image rendering to DetailRenderer</name>
  <files>src/components/renderers/DetailRenderer.tsx</files>
  <action>
Modify `src/components/renderers/DetailRenderer.tsx`:

1. Add import: `import { isImageUrl } from '../../utils/imageDetection'`

2. In the `renderFields()` function, inside the primitive field rendering block (currently starting at line 107 `if (fieldDef.type.kind === 'primitive')`), add image detection BEFORE the existing grid-based rendering:

   After getting `value` and `fieldPath`, add:
   ```typescript
   // Check if this is an image URL — render full-width
   const isImage = typeof value === 'string' && isImageUrl(value)

   if (isImage) {
     const imageContent = (
       <div className="space-y-2">
         <div className="text-sm font-medium text-gray-600">
           {displayLabel}
         </div>
         <img
           src={value as string}
           alt={displayLabel}
           loading="lazy"
           className="w-full max-h-96 object-contain rounded-lg border border-gray-200 bg-gray-50"
           onError={(e) => { e.currentTarget.style.display = 'none' }}
         />
       </div>
     )

     // Wrap with FieldControls/DraggableField in Configure mode (same pattern as existing)
     if (isConfigureMode) {
       return (
         <DraggableField key={fieldName} id={fieldPath}>
           <FieldControls
             fieldPath={fieldPath}
             fieldName={fieldName}
             isVisible={isVisible}
             customLabel={config?.label}
           >
             {imageContent}
           </FieldControls>
         </DraggableField>
       )
     }
     return <div key={fieldName}>{imageContent}</div>
   }
   ```

   Image rendering:
   - `w-full max-h-96` fills width, caps height at 384px
   - `object-contain` preserves aspect ratio
   - `rounded-lg border border-gray-200 bg-gray-50` provides visual framing
   - `onError` hides the image on load failure
   - `loading="lazy"` for performance
  </action>
  <verify>
Run `npx tsc --noEmit`. Open a detail view for a record with image URLs — images should render full-width.
  </verify>
  <done>Image URL fields in detail views render as full-width images with graceful error handling</done>
</task>

<task type="auto">
  <name>Task 2: Add typography hierarchy for primary/secondary fields</name>
  <files>src/components/renderers/DetailRenderer.tsx</files>
  <action>
Continue modifying `src/components/renderers/DetailRenderer.tsx`:

1. Add a helper function before the component:
   ```typescript
   /** Detect primary fields (name, title, label, heading, subject) for typography hierarchy */
   function isPrimaryField(fieldName: string): boolean {
     const primaryPatterns = ['name', 'title', 'label', 'heading', 'subject']
     const nameLower = fieldName.toLowerCase()
     return primaryPatterns.some(pattern =>
       nameLower === pattern || nameLower.endsWith(`_${pattern}`) || nameLower.endsWith(`${pattern}`)
     )
   }
   ```

   Be careful with the matching: we want exact matches like "name", "title" AND compound names like "display_name", "full_name", "job_title". But NOT false positives like "renamed" or "entitled". Use a match strategy:
   - Exact match: `nameLower === pattern`
   - Suffix with separator: `nameLower.endsWith('_' + pattern)` or `nameLower.endsWith('-' + pattern)`
   - Starts with pattern: `nameLower === pattern` (already covered by exact)

   Refined implementation:
   ```typescript
   function isPrimaryField(fieldName: string): boolean {
     const nameLower = fieldName.toLowerCase()
     const primaryExact = ['name', 'title', 'label', 'heading', 'subject']
     if (primaryExact.includes(nameLower)) return true

     const primarySuffixes = ['_name', '_title', '_label', '-name', '-title', '-label', 'Name', 'Title']
     return primarySuffixes.some(suffix => fieldName.endsWith(suffix))
   }
   ```

2. In the primitive field rendering (the non-image path, the existing grid layout), apply typography classes based on `isPrimaryField(fieldName)`:

   Replace the existing label div class:
   - Current: `"text-sm font-medium text-gray-600 py-1"`
   - Primary fields: `"text-base font-semibold text-gray-700 py-1"`
   - Secondary fields: `"text-sm font-medium text-gray-600 py-1"` (unchanged)

   Replace the existing value div class:
   - Current: `"py-1"` (no specific styling, PrimitiveRenderer handles text)
   - Primary fields: `"py-1 text-lg font-semibold text-gray-900"`
   - Secondary fields: `"py-1"` (unchanged)

   Implementation:
   ```typescript
   const primary = isPrimaryField(fieldName)

   const fieldContent = (
     <div className="grid grid-cols-[auto_1fr] gap-x-6">
       <div className={primary
         ? "text-base font-semibold text-gray-700 py-1"
         : "text-sm font-medium text-gray-600 py-1"
       }>
         {displayLabel}:
       </div>
       <div className={primary
         ? "py-1 text-lg font-semibold text-gray-900"
         : "py-1"
       }>
         <PrimitiveRenderer
           data={value}
           schema={fieldDef.type}
           path={fieldPath}
           depth={depth + 1}
         />
       </div>
     </div>
   )
   ```
  </action>
  <verify>
Run `npx tsc --noEmit`. Open detail views — fields named "name", "title", "display_name" etc. should have noticeably larger/bolder typography than fields like "id", "email", "created_at".
  </verify>
  <done>Primary fields render with larger/bolder typography, secondary fields retain existing styling, hierarchy is visually distinct</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` completes successfully
3. Detail views show full-width images for image-URL fields
4. Primary fields (name, title, label, heading, subject, display_name, job_title) have larger/bolder typography
5. Secondary fields (id, email, created_at, etc.) retain standard styling
6. Typography hierarchy works in both View and Configure modes
7. Broken images hide gracefully
</verification>

<success_criteria>
- DetailRenderer renders image URLs as full-width images with error handling
- Primary fields display with visually distinct, larger typography
- Secondary fields retain standard styling
- Both features work in View and Configure modes
- No TypeScript errors, build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/05-smart-visual-defaults/05-03-SUMMARY.md`
</output>
