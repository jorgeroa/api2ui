---
phase: 05-smart-visual-defaults
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/renderers/CardListRenderer.tsx
  - src/components/renderers/TableRenderer.tsx
autonomous: true

must_haves:
  truths:
    - "Card view detects first image-URL field and displays it as hero image at the top of each card"
    - "Table view shows thumbnail previews (32x32) for image-URL columns alongside truncated URL text"
    - "Hero image fields are not duplicated in the card body field list"
    - "Broken hero/thumbnail images hide gracefully without layout shift"
  artifacts:
    - path: "src/components/renderers/CardListRenderer.tsx"
      provides: "Hero image detection and rendering in cards"
      contains: "isImageUrl"
    - path: "src/components/renderers/TableRenderer.tsx"
      provides: "Thumbnail image rendering in table cells"
      contains: "isImageUrl"
  key_links:
    - from: "src/components/renderers/CardListRenderer.tsx"
      to: "src/utils/imageDetection.ts"
      via: "import { isImageUrl }"
      pattern: "import.*isImageUrl.*imageDetection"
    - from: "src/components/renderers/TableRenderer.tsx"
      to: "src/utils/imageDetection.ts"
      via: "import { isImageUrl }"
      pattern: "import.*isImageUrl.*imageDetection"
---

<objective>
Add hero images to card views and thumbnail previews to table views, making data with image URLs visually rich by default.

Purpose: Cards and tables are the two primary collection renderers — enhancing them with image detection transforms the app from a data browser into a visual directory.
Output: CardListRenderer with hero images, TableRenderer with inline thumbnails.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-smart-visual-defaults/05-01-SUMMARY.md
@src/components/renderers/CardListRenderer.tsx
@src/components/renderers/TableRenderer.tsx
@src/utils/imageDetection.ts
@src/types/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add hero images to CardListRenderer</name>
  <files>src/components/renderers/CardListRenderer.tsx</files>
  <action>
Modify `src/components/renderers/CardListRenderer.tsx`:

1. Add import: `import { isImageUrl } from '../../utils/imageDetection'`

2. Add a helper function `getHeroImageField` before the component:
   ```typescript
   function getHeroImageField(
     item: Record<string, unknown>,
     fields: Array<[string, FieldDefinition]>
   ): { fieldName: string; url: string } | null {
     for (const [fieldName, fieldDef] of fields) {
       if (fieldDef.type.kind === 'primitive') {
         const value = item[fieldName]
         if (typeof value === 'string' && isImageUrl(value)) {
           return { fieldName, url: value }
         }
       }
     }
     return null
   }
   ```
   Import `FieldDefinition` from `../../types/schema`.

3. Inside the card map function, after getting `title`:
   - Call `const heroImage = getHeroImageField(obj, fields)`
   - Before the card `<div className="p-4">` content, add a hero image container:
     ```
     {heroImage && (
       <div className="w-full h-48 bg-gray-100 overflow-hidden">
         <img
           src={heroImage.url}
           alt={title}
           loading="lazy"
           className="w-full h-full object-cover"
           onError={(e) => {
             (e.currentTarget.parentElement as HTMLElement).style.display = 'none'
           }}
         />
       </div>
     )}
     ```
   - Fixed height `h-48` prevents CLS (Pitfall 2 from research)
   - `bg-gray-100` provides placeholder background while loading
   - onError hides the container (not just the img) to avoid empty space

4. Change the card's outer div class: replace `p-4` with `overflow-hidden` (move padding to inner content div). The card needs `overflow-hidden` for the hero image to be flush with card edges.

5. In the displayFields map, skip the hero image field to avoid duplication:
   ```
   if (heroImage && fieldName === heroImage.fieldName) return null
   ```

6. Wrap the existing card content (title + fields) in a `<div className="p-4">` to maintain padding below the hero image.
  </action>
  <verify>
Run `npx tsc --noEmit`. Load an API with image URLs in card view — hero images should appear at top of cards.
  </verify>
  <done>Cards display hero image from first detected image-URL field, hero field not duplicated in body, broken images hide gracefully</done>
</task>

<task type="auto">
  <name>Task 2: Add thumbnail previews to TableRenderer</name>
  <files>src/components/renderers/TableRenderer.tsx</files>
  <action>
Modify `src/components/renderers/TableRenderer.tsx`:

1. Add import: `import { isImageUrl } from '../../utils/imageDetection'`

2. In the cell rendering section (currently lines 189-213, inside `visibleColumns.map`), add image detection BEFORE the existing PrimitiveRenderer/CompactValue logic:

   After getting `value` and `cellPath`, add:
   ```typescript
   // Check if this cell contains an image URL
   const isImage = fieldDef.type.kind === 'primitive' &&
                   typeof value === 'string' &&
                   isImageUrl(value)
   ```

3. Replace the cell content `<div className="truncate w-full">` block with conditional rendering:
   ```
   {isImage ? (
     <div className="flex items-center gap-2 w-full">
       <img
         src={value as string}
         alt={fieldName}
         loading="lazy"
         className="h-8 w-8 rounded object-cover flex-shrink-0"
         onError={(e) => { e.currentTarget.style.display = 'none' }}
       />
       <span className="text-xs text-gray-500 truncate" title={value as string}>
         {(value as string).split('/').pop() || value}
       </span>
     </div>
   ) : (
     <div className="truncate w-full">
       {/* existing PrimitiveRenderer / CompactValue code */}
     </div>
   )}
   ```

   The thumbnail is 32x32 (`h-8 w-8`), fits within the 40px row height.
   The filename (last path segment) shows next to the thumbnail for context.
   Fixed dimensions prevent CLS.
  </action>
  <verify>
Run `npx tsc --noEmit`. Load an API with image URLs in table view — thumbnail previews should appear inline in cells.
  </verify>
  <done>Table cells with image URLs show 32x32 thumbnail with filename, broken thumbnails hide gracefully</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` completes successfully
3. Cards show hero images at top from first image-URL field
4. Hero image field is not repeated in card body
5. Table cells with image URLs show thumbnail + filename
6. Broken images in both cards and tables hide gracefully
7. Non-image-URL fields render unchanged
</verification>

<success_criteria>
- CardListRenderer detects and renders hero images from first image-URL field
- TableRenderer shows inline thumbnail previews for image-URL cells
- Both handle broken images gracefully (hide, no layout shift)
- No TypeScript errors, build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/05-smart-visual-defaults/05-02-SUMMARY.md`
</output>
