---
phase: 16-context-aware-components
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/badge.tsx
  - src/components/renderers/semantic/StatusBadge.tsx
  - src/components/renderers/semantic/StarRating.tsx
  - src/components/renderers/semantic/CurrencyValue.tsx
  - src/components/renderers/semantic/FormattedDate.tsx
  - src/components/renderers/semantic/TagChips.tsx
autonomous: true

must_haves:
  truths:
    - "StatusBadge renders green/red/yellow/gray badges for positive/negative/in-progress/neutral status values"
    - "StatusBadge renders boolean values as green check / gray X badges"
    - "StarRating renders filled/half/empty Unicode stars with numeric value"
    - "CurrencyValue formats amounts using Intl.NumberFormat with locale-aware display"
    - "FormattedDate formats dates using Intl.DateTimeFormat with time shown only when ISO string includes T"
    - "TagChips renders monochrome chips with copy-on-click and +N more truncation"
  artifacts:
    - path: "src/components/renderers/semantic/StatusBadge.tsx"
      provides: "Status badge with semantic color mapping and boolean support"
    - path: "src/components/renderers/semantic/StarRating.tsx"
      provides: "Star rating display with half-star precision"
    - path: "src/components/renderers/semantic/CurrencyValue.tsx"
      provides: "Currency formatting with sibling field detection"
    - path: "src/components/renderers/semantic/FormattedDate.tsx"
      provides: "Locale-aware date/time formatting"
    - path: "src/components/renderers/semantic/TagChips.tsx"
      provides: "Tag chips with copy-on-click and truncation"
    - path: "src/components/ui/badge.tsx"
      provides: "Badge component with success and warning variants"
  key_links:
    - from: "src/components/renderers/semantic/StatusBadge.tsx"
      to: "src/components/ui/badge.tsx"
      via: "import Badge"
      pattern: "import.*Badge.*from.*ui/badge"
    - from: "src/components/renderers/semantic/TagChips.tsx"
      to: "sonner"
      via: "toast for copy feedback"
      pattern: "import.*toast.*from.*sonner"
    - from: "src/components/renderers/semantic/CurrencyValue.tsx"
      to: "Intl.NumberFormat"
      via: "native currency formatting"
      pattern: "Intl\\.NumberFormat"
---

<objective>
Create all five semantic rendering components (StatusBadge, TagChips, StarRating, CurrencyValue, FormattedDate) and add missing Badge variants (success, warning) to the shadcn Badge component.

Purpose: These components form the visual building blocks for context-aware rendering. Each component encapsulates formatting logic for a specific semantic type, keeping PrimitiveRenderer clean when integration happens in Plan 02.

Output: Six files — five semantic components in `src/components/renderers/semantic/` and an updated Badge component with success/warning variants.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-context-aware-components/16-CONTEXT.md
@.planning/phases/16-context-aware-components/16-RESEARCH.md
@src/components/ui/badge.tsx
@src/components/renderers/PrimitiveRenderer.tsx
@src/services/semantic/types.ts
@src/types/schema.ts
@src/store/appStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add success and warning Badge variants + Create StatusBadge and StarRating</name>
  <files>
    src/components/ui/badge.tsx
    src/components/renderers/semantic/StatusBadge.tsx
    src/components/renderers/semantic/StarRating.tsx
  </files>
  <action>
    **badge.tsx:** Add two new variants to the `badgeVariants` cva definition:
    - `success`: green styling — `"bg-green-100 text-green-800 [a&]:hover:bg-green-200"` (pill badge for positive states)
    - `warning`: yellow/amber styling — `"bg-amber-100 text-amber-800 [a&]:hover:bg-amber-200"` (pill badge for in-progress states)

    **StatusBadge.tsx:** Create `src/components/renderers/semantic/StatusBadge.tsx`:
    - Export `StatusBadge` component with props `{ value: string | boolean }`
    - Boolean handling: `true` renders Badge variant="success" with Check icon (lucide-react) + "True" text; `false` renders Badge variant="secondary" with X icon + "False" text
    - String handling: normalize value with `.toLowerCase().trim()`, then map to Badge variant:
      - `success` variant: match `/^(active|success|published|verified|approved|complete|completed|enabled|paid|delivered|open|live|available|done)$/i`
      - `destructive` variant: match `/^(error|failed|deleted|banned|rejected|cancelled|canceled|inactive|disabled|closed|expired|denied|blocked)$/i`
      - `warning` variant: match `/^(pending|processing|review|in.?review|scheduled|syncing|indexing|draft|paused|waiting|suspended|on.?hold)$/i`
      - `secondary` variant: fallback for all other values (gray neutral badge)
    - Display the original (not normalized) string value as badge text
    - Import `Badge` from `@/components/ui/badge`, import `Check, X` from `lucide-react`

    **StarRating.tsx:** Create `src/components/renderers/semantic/StarRating.tsx`:
    - Export `StarRating` component with props `{ value: number; max?: number }` (default max=5)
    - Clamp value to [0, max] range
    - Calculate: fullStars = Math.floor(clamped), hasHalf = (clamped - fullStars) >= 0.5, emptyStars = max - fullStars - (hasHalf ? 1 : 0)
    - Render filled stars as `<span className="text-yellow-400">&#9733;</span>`, half star as `<span className="text-yellow-300">&#9733;</span>`, empty stars as `<span className="text-gray-300">&#9734;</span>` (hollow star ☆)
    - After stars, show numeric value: `<span className="text-xs text-gray-500 ml-1">({value.toFixed(1)})</span>`
    - Wrap in `<span className="inline-flex items-center gap-0.5" title={\`${value} out of ${max}\`}>`
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify no type errors.
    Check that badge.tsx exports success and warning variants.
    Check that StatusBadge.tsx and StarRating.tsx compile without errors.
  </verify>
  <done>
    Badge component has success (green) and warning (amber) variants.
    StatusBadge renders semantic-colored pill badges for status strings and boolean check/X badges.
    StarRating renders filled/half/empty Unicode stars with numeric label.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CurrencyValue, FormattedDate, and TagChips</name>
  <files>
    src/components/renderers/semantic/CurrencyValue.tsx
    src/components/renderers/semantic/FormattedDate.tsx
    src/components/renderers/semantic/TagChips.tsx
  </files>
  <action>
    **CurrencyValue.tsx:** Create `src/components/renderers/semantic/CurrencyValue.tsx`:
    - Export `CurrencyValue` component with props `{ amount: number | string; currencyCode?: string }`
    - Parse amount: `typeof amount === 'string' ? parseFloat(amount) : amount`; if NaN, render raw value as text
    - Use `currencyCode` prop if provided, default to `'USD'`
    - Format with `new Intl.NumberFormat(navigator.language, { style: 'currency', currency: currencyCode }).format(numAmount)`
    - Wrap in try/catch: if Intl throws (invalid currency code), fallback to USD formatting
    - Render as `<span title={\`${numAmount} ${currencyCode}\`}>{formatted}</span>`

    Also export a helper function `detectCurrencyFromSiblings(fieldName: string, parentObj: Record<string, unknown>): string`:
    - Look for sibling fields named `currency_code`, `currency`, `currency_id` in parentObj
    - If found and matches `/^[A-Z]{3}$/`, return that value
    - Otherwise return `'USD'`
    - This helper is used by PrimitiveRenderer in Plan 02 to pass the currencyCode prop

    **FormattedDate.tsx:** Create `src/components/renderers/semantic/FormattedDate.tsx`:
    - Export `FormattedDate` component with props `{ value: string | number | Date }`
    - Parse value: if string, `new Date(value)`; if number, `new Date(value)`; if Date, use directly
    - If invalid date (isNaN(date.getTime())), render `<span className="text-muted-foreground italic">Invalid date</span>`
    - Detect time presence: `typeof value === 'string' && value.includes('T')` (per user decision)
    - Base options: `{ year: 'numeric', month: 'short', day: 'numeric' }` — always show year per user decision
    - If hasTime, add `{ hour: '2-digit', minute: '2-digit' }`
    - Format with `new Intl.DateTimeFormat(navigator.language, options).format(date)`
    - Render as `<span title={typeof value === 'string' ? value : date.toISOString()}>{formatted}</span>`
    - NO relative dates ("2 days ago") — absolute only per user decision

    **TagChips.tsx:** Create `src/components/renderers/semantic/TagChips.tsx`:
    - Export `TagChips` component with props `{ tags: string[]; maxVisible?: number }` (default maxVisible=5)
    - Local state: `const [expanded, setExpanded] = useState(false)`
    - Compute visibleTags: `expanded ? tags : tags.slice(0, maxVisible)`
    - Compute hiddenCount: `tags.length - maxVisible`
    - Each chip renders as a `<button>` with classes: `"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-muted text-muted-foreground hover:bg-muted/80 transition-colors cursor-pointer"` — monochrome/neutral per user decision (NO color coding)
    - Copy on click: `async () => { await navigator.clipboard.writeText(tag); toast.success('Copied to clipboard') }` — wrap in try/catch, toast.error on failure
    - Import `toast` from `sonner`
    - If `!expanded && hiddenCount > 0`, show expand button: `<button onClick={() => setExpanded(true)} className="text-xs text-muted-foreground hover:underline">+{hiddenCount} more</button>`
    - Each chip has `title="Click to copy"` for accessibility
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify no type errors.
    Check that all three files exist and compile.
    Verify TagChips imports `toast` from `sonner` and `useState` from `react`.
  </verify>
  <done>
    CurrencyValue formats amounts with Intl.NumberFormat and locale-aware display.
    FormattedDate formats dates absolutely with time shown when ISO T detected.
    TagChips renders monochrome chips with copy-on-click sonner toast feedback and +N more truncation.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. All 5 semantic component files exist in `src/components/renderers/semantic/`
3. Badge component has `success` and `warning` variants alongside existing variants
4. No new dependencies added (all imports use existing packages)
</verification>

<success_criteria>
- Five semantic components compile and export their main component
- Badge has 6 variants total (default, secondary, destructive, outline, ghost, link + success + warning = 8 total)
- Components use Intl APIs for formatting (no custom date/currency parsing)
- TagChips uses sonner toast for copy feedback
- StatusBadge handles both string and boolean inputs
- StarRating supports half-star precision
- No relative date formatting in FormattedDate
</success_criteria>

<output>
After completion, create `.planning/phases/16-context-aware-components/16-01-SUMMARY.md`
</output>
