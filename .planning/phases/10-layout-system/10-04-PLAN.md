---
phase: 10-layout-system
plan: 04
type: execute
wave: 2
depends_on: ["10-01", "10-02", "10-03"]
files_modified:
  - package.json
  - src/components/layout/LayoutSwitcher.tsx
  - src/components/layout/LayoutContainer.tsx
autonomous: true

must_haves:
  truths:
    - "User can switch between sidebar, top bar, and split view layouts"
    - "Layout switcher shows icon-only toggle group with tooltips"
    - "Layout switcher is hidden on mobile"
    - "LayoutContainer renders correct layout based on mode and viewport"
  artifacts:
    - path: "src/components/layout/LayoutSwitcher.tsx"
      provides: "Icon toggle group for layout selection"
      exports: ["LayoutSwitcher"]
    - path: "src/components/layout/LayoutContainer.tsx"
      provides: "Orchestrator that selects and renders appropriate layout"
      exports: ["LayoutContainer"]
  key_links:
    - from: "src/components/layout/LayoutSwitcher.tsx"
      to: "@radix-ui/react-toggle-group"
      via: "import"
      pattern: "import.*ToggleGroup.*@radix-ui"
    - from: "src/components/layout/LayoutContainer.tsx"
      to: "src/store/layoutStore.ts"
      via: "import useLayoutStore"
      pattern: "useLayoutStore"
    - from: "src/components/layout/LayoutContainer.tsx"
      to: "src/hooks/useMediaQuery.ts"
      via: "import useMediaQuery"
      pattern: "useMediaQuery"
---

<objective>
Create the Layout Switcher UI control and LayoutContainer orchestrator. Install @radix-ui/react-toggle-group for accessible toggle buttons. LayoutContainer ties all layout components together and selects the right one based on user preference and viewport.

Purpose: This implements LAYOUT-01 (user-selectable layout presets) and wires up all the individual layout components from Plans 02 and 03.

Output: A complete layout switching system ready to be integrated into App.tsx.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/10-layout-system/10-CONTEXT.md
@.planning/phases/10-layout-system/10-RESEARCH.md
@.planning/phases/10-layout-system/10-01-SUMMARY.md
@.planning/phases/10-layout-system/10-02-SUMMARY.md
@.planning/phases/10-layout-system/10-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Radix Toggle Group</name>
  <files>package.json</files>
  <action>
Install @radix-ui/react-toggle-group for accessible icon-only layout switcher.

```bash
npm install @radix-ui/react-toggle-group
```

This provides:
- Roving tabindex keyboard navigation
- Proper ARIA attributes (role="group", aria-pressed)
- data-state attribute for styling active state
  </action>
  <verify>
Package installed: `npm ls @radix-ui/react-toggle-group`
  </verify>
  <done>
@radix-ui/react-toggle-group is installed and available for import.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create LayoutSwitcher Component</name>
  <files>src/components/layout/LayoutSwitcher.tsx</files>
  <action>
Create an icon-only toggle group for switching between layout modes.

**Props:**
```typescript
interface LayoutSwitcherProps {
  value: LayoutMode
  onChange: (value: LayoutMode) => void
  className?: string
}
```

**Structure using Radix Toggle Group:**
```typescript
import * as ToggleGroup from '@radix-ui/react-toggle-group'
```

**Three toggle items (desktop only - drawer is automatic on mobile):**
1. sidebar - icon showing left panel + main area
2. topbar - icon showing top bar + main area below
3. split - icon showing vertical split

**Icons (inline SVG - per Phase 9 decision):**
Create simple 20x20 SVG icons representing each layout:
- Sidebar: rectangle split vertically, left portion filled
- Top bar: rectangle split horizontally, top portion filled
- Split: rectangle split vertically, both portions outlined

**Styling (from CONTEXT.md and RESEARCH.md):**
- Compact icon-only toggle group
- Border around group (border border-gray-200 rounded-lg)
- Items: p-2, hover:bg-gray-100, transition-colors
- Active state: data-[state=on]:bg-blue-100 data-[state=on]:text-blue-700
- Focus visible: focus-visible:ring-2 focus-visible:ring-blue-500

**Tooltips:**
Use native title attribute for simple tooltips (avoid adding Radix Tooltip dependency for now).
- sidebar: title="Sidebar layout"
- topbar: title="Top bar layout"
- split: title="Split view layout"

**Accessibility:**
- aria-label on each item
- aria-label="Layout mode" on ToggleGroup.Root
  </action>
  <verify>
File exists: `ls src/components/layout/LayoutSwitcher.tsx`
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
LayoutSwitcher component renders icon-only toggle group with three layout options, proper accessibility, and hover tooltips.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create LayoutContainer Component</name>
  <files>src/components/layout/LayoutContainer.tsx</files>
  <action>
Create the orchestrator component that:
1. Reads layout preference from store
2. Detects mobile viewport
3. Renders appropriate layout component
4. Preserves form state during layout switches

**Props:**
```typescript
interface LayoutContainerProps {
  parameters: React.ReactNode
  results: React.ReactNode
  endpoint: string  // Used for per-endpoint layout preference
  className?: string
}
```

**Implementation:**

1. **Get layout preference:**
```typescript
const { getLayout, setLayout } = useLayoutStore()
const layout = getLayout(endpoint)
```

2. **Detect mobile:**
```typescript
const isMobile = useMediaQuery('(max-width: 767px)')
```

3. **Drawer state (for mobile):**
```typescript
const [drawerOpen, setDrawerOpen] = useState(false)
```

4. **Render logic:**
- If mobile: always render DrawerLayout
- If desktop: render based on layout preference (sidebar/topbar/split)

5. **Form state preservation (CRITICAL):**
Per CONTEXT.md: "Preserve unsaved form values across layout switches"
Per RESEARCH.md: Keep components mounted with CSS visibility, not conditional rendering.

However, since parameters is passed as React.ReactNode (already rendered), it naturally stays mounted. The issue would only arise if we unmounted/remounted the LayoutContainer itself.

The layouts receive the same parameters prop, so React will reuse the same component tree.

6. **Include LayoutSwitcher in the UI:**
Render LayoutSwitcher at the top of the container (only on desktop).

**Structure:**
```tsx
return (
  <div className={className}>
    {/* Layout switcher - desktop only */}
    {!isMobile && (
      <div className="flex justify-end mb-4">
        <LayoutSwitcher
          value={layout}
          onChange={(newLayout) => setLayout(endpoint, newLayout)}
        />
      </div>
    )}

    {/* Mobile: always drawer */}
    {isMobile && (
      <>
        {/* Floating button to open drawer */}
        <button onClick={() => setDrawerOpen(true)} ...>
          Filter icon
        </button>
        <DrawerLayout
          parameters={parameters}
          results={results}
          isOpen={drawerOpen}
          onOpenChange={setDrawerOpen}
        />
      </>
    )}

    {/* Desktop: selected layout */}
    {!isMobile && layout === 'sidebar' && (
      <SidebarLayout parameters={parameters} results={results} />
    )}
    {!isMobile && layout === 'topbar' && (
      <TopBarLayout parameters={parameters} results={results} />
    )}
    {!isMobile && layout === 'split' && (
      <SplitLayout parameters={parameters} results={results} />
    )}
  </div>
)
```

**Mobile drawer trigger button:**
A floating action button (FAB) or toolbar button to open the drawer. Style as:
- Fixed bottom-right on mobile
- Filter/sliders icon
- bg-blue-600 text-white rounded-full p-3 shadow-lg
  </action>
  <verify>
File exists: `ls src/components/layout/LayoutContainer.tsx`
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
LayoutContainer orchestrates layout selection based on viewport and user preference, includes LayoutSwitcher for desktop, and mobile drawer trigger for mobile.
  </done>
</task>

</tasks>

<verification>
1. npm install completed successfully
2. All files exist in src/components/layout/
3. TypeScript compiles: `npx tsc --noEmit`
4. LayoutSwitcher imports from @radix-ui/react-toggle-group
5. LayoutContainer imports useLayoutStore and useMediaQuery
6. LayoutContainer imports all four layout components
</verification>

<success_criteria>
- @radix-ui/react-toggle-group installed
- LayoutSwitcher.tsx exports component with three layout toggle buttons
- LayoutContainer.tsx exports component that:
  - Uses layout store for preferences
  - Uses useMediaQuery for mobile detection
  - Renders correct layout based on mode + viewport
  - Includes layout switcher on desktop
  - Includes drawer trigger on mobile
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-layout-system/10-04-SUMMARY.md`
</output>
