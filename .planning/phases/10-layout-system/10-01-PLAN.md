---
phase: 10-layout-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/store/layoutStore.ts
  - src/hooks/useMediaQuery.ts
autonomous: true

must_haves:
  truths:
    - "Layout preference persists per endpoint across browser sessions"
    - "Mobile breakpoint (768px) is detected correctly"
  artifacts:
    - path: "src/store/layoutStore.ts"
      provides: "Layout preference persistence with Zustand"
      exports: ["useLayoutStore", "LayoutMode"]
    - path: "src/hooks/useMediaQuery.ts"
      provides: "Responsive breakpoint detection"
      exports: ["useMediaQuery"]
  key_links:
    - from: "src/store/layoutStore.ts"
      to: "localStorage"
      via: "Zustand persist middleware"
      pattern: "persist.*api2ui-layouts"
---

<objective>
Create the layout state management foundation: a Zustand store for per-endpoint layout preferences and a media query hook for responsive breakpoint detection.

Purpose: These are the building blocks that all layout components depend on. The store enables LAYOUT-06 (persistence), and the hook enables LAYOUT-05 (mobile drawer detection).

Output: Two utility files that can be imported by layout components in subsequent plans.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-layout-system/10-CONTEXT.md
@.planning/phases/10-layout-system/10-RESEARCH.md
@src/store/parameterStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Layout Store</name>
  <files>src/store/layoutStore.ts</files>
  <action>
Create a Zustand store with persist middleware following the exact pattern from parameterStore.ts.

**Type definition:**
```typescript
type LayoutMode = 'sidebar' | 'topbar' | 'split'
```

Note: 'drawer' is NOT in the type - drawer is automatically applied on mobile via CSS/hook, not a user selection.

**State shape:**
- `layouts: Record<string, LayoutMode>` - endpoint URL to layout preference
- `defaultLayout: LayoutMode` - default is 'topbar' (per research)

**Operations:**
- `getLayout(endpoint: string): LayoutMode` - returns stored layout or defaultLayout
- `setLayout(endpoint: string, layout: LayoutMode): void` - saves preference
- `clearLayout(endpoint: string): void` - removes preference for endpoint

**Persistence config:**
- name: 'api2ui-layouts'
- version: 1
- storage: createJSONStorage(() => localStorage)
- partialize: only persist layouts and defaultLayout

Follow parameterStore.ts structure exactly for consistency.
  </action>
  <verify>
TypeScript compiles without errors: `npx tsc --noEmit`
  </verify>
  <done>
layoutStore.ts exports useLayoutStore and LayoutMode type. Store can save/retrieve layout preferences keyed by endpoint URL.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create useMediaQuery Hook</name>
  <files>src/hooks/useMediaQuery.ts</files>
  <action>
Create a reusable media query hook for responsive breakpoint detection.

**Signature:**
```typescript
function useMediaQuery(query: string): boolean
```

**Implementation:**
1. Use useState with SSR-safe initialization (check typeof window)
2. Use matchMedia API with 'change' event listener (modern API, not deprecated addListener)
3. Return boolean indicating if query matches
4. Clean up event listener on unmount

**SSR Safety:**
- If window is undefined, return false as default
- Only add listeners after component mounts

The hook will be used as:
```typescript
const isMobile = useMediaQuery('(max-width: 767px)')
```

Note: Use 767px (not 768px) so that exactly 768px triggers desktop mode. This matches Tailwind's md: breakpoint which is min-width: 768px.
  </action>
  <verify>
TypeScript compiles without errors: `npx tsc --noEmit`
  </verify>
  <done>
useMediaQuery hook exported, returns boolean based on CSS media query match. Works with any media query string.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Store follows same pattern as parameterStore.ts (compare side by side)
3. Hook uses modern matchMedia API with addEventListener (not deprecated addListener)
</verification>

<success_criteria>
- layoutStore.ts exists with getLayout/setLayout/clearLayout operations
- useMediaQuery.ts exists with boolean return value
- Both files compile without TypeScript errors
- Store uses 'api2ui-layouts' as localStorage key
</success_criteria>

<output>
After completion, create `.planning/phases/10-layout-system/10-01-SUMMARY.md`
</output>
