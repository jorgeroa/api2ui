---
phase: 09-url-parsing-type-inference
plan: 04
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/components/forms/ParameterGroup.tsx
  - src/services/urlParser/groupUtils.ts
autonomous: true

must_haves:
  truths:
    - "Parameters with common prefixes group into collapsible accordion sections"
    - "All groups collapsed by default"
    - "Chevron indicator rotates when group is open"
    - "Group names are humanized (ddcFilter -> Filters)"
    - "Ungrouped parameters appear separately from grouped sections"
  artifacts:
    - path: "src/components/forms/ParameterGroup.tsx"
      provides: "Accordion wrapper for grouped parameters"
      exports: ["ParameterGroup"]
    - path: "src/services/urlParser/groupUtils.ts"
      provides: "Group humanization utilities"
      exports: ["humanizeGroupName", "extractGroupPrefix"]
  key_links:
    - from: "src/components/forms/ParameterGroup.tsx"
      to: "@headlessui/react Disclosure"
      via: "Disclosure, DisclosureButton, DisclosurePanel"
      pattern: "import.*Disclosure.*from.*@headlessui/react"
---

<objective>
Create parameter grouping UI with collapsible accordion sections for related parameters.

Purpose: Parameters with common prefixes (e.g., ddcFilter[name], ddcFilter[age]) auto-group into "Filters" section. This reduces visual clutter and helps users find related parameters.

Output: ParameterGroup accordion component and group humanization utilities.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-url-parsing-type-inference/09-RESEARCH.md
@.planning/phases/09-url-parsing-type-inference/09-CONTEXT.md

# Existing Disclosure pattern to follow
@src/components/navigation/TagGroup.tsx

# Parser types from Plan 01
@src/services/urlParser/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Group Utilities</name>
  <files>src/services/urlParser/groupUtils.ts</files>
  <action>
Create utility functions for parameter group handling.

**Functions:**

```typescript
/**
 * Extract group prefix from parameter name
 * "ddcFilter[name]" -> "ddcFilter"
 * "tag[]" -> null (array notation, not a group)
 * "simpleName" -> null (no group)
 */
export function extractGroupPrefix(name: string): string | null

/**
 * Humanize group name for display
 * "ddcFilter" -> "Filters"
 * "searchParams" -> "Search"
 * "HTMLOptions" -> "HTML Options" (handle acronyms)
 * "filter2" -> "Filter 2" (handle numbers)
 */
export function humanizeGroupName(name: string): string
```

**Humanization rules:**
1. Split on camelCase boundaries: /([A-Z])/g -> ' $1'
2. Split on numbers: /(\d+)/g -> ' $1'
3. Remove common suffixes: filter, param, params, options, option, config
4. Capitalize first letter
5. Trim and handle empty result (return original if all stripped)

**Examples:**
- "ddcFilter" -> "DDC" (filter removed, but preserve caps)
- "searchParams" -> "Search"
- "userOptions" -> "User"
- "HTMLConfig" -> "HTML"
- "filter2Settings" -> "Filter 2 Settings"
- "foo" -> "Foo" (no transformation needed)
  </action>
  <verify>
```bash
# Verify file exists and exports functions
grep -l "export function humanizeGroupName" src/services/urlParser/groupUtils.ts
grep -l "export function extractGroupPrefix" src/services/urlParser/groupUtils.ts
```
  </verify>
  <done>
- extractGroupPrefix correctly identifies bracket-prefix groups
- humanizeGroupName produces readable group labels
- Edge cases handled (acronyms, numbers, empty after suffix removal)
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ParameterGroup Component</name>
  <files>src/components/forms/ParameterGroup.tsx</files>
  <action>
Create accordion component for grouped parameters following TagGroup.tsx pattern.

**Props interface:**
```typescript
interface ParameterGroupProps {
  groupName: string           // Raw group name (e.g., "ddcFilter")
  children: React.ReactNode   // Parameter inputs to render inside
  defaultOpen?: boolean       // Default: false (all collapsed per user decision)
}
```

**Implementation:**
1. Use Headless UI Disclosure with defaultOpen={false}
2. Display humanized group name using humanizeGroupName()
3. Chevron icon that rotates 90deg when open (match TagGroup.tsx pattern)
4. DisclosurePanel contains children with proper spacing

**Styling (match existing patterns):**
- Button: flex items-center justify-between w-full px-3 py-2 hover:bg-gray-50
- Text: font-semibold text-sm text-gray-700
- Chevron: w-4 h-4 transition-transform, rotate-90 when open
- Panel: space-y-3 pl-4 (indent children)

**Usage pattern:**
```tsx
<ParameterGroup groupName="ddcFilter">
  <ParameterInput parameter={param1} ... />
  <ParameterInput parameter={param2} ... />
</ParameterGroup>
```
  </action>
  <verify>
```bash
# Verify file exists and exports component
grep -l "export function ParameterGroup" src/components/forms/ParameterGroup.tsx
# Verify Disclosure usage
grep "Disclosure" src/components/forms/ParameterGroup.tsx
# Verify humanization import
grep "humanizeGroupName" src/components/forms/ParameterGroup.tsx
```
  </verify>
  <done>
- ParameterGroup renders as collapsible accordion
- Groups collapsed by default
- Chevron rotates on open/close
- Group name humanized in header
- Children rendered inside panel with proper spacing
  </done>
</task>

</tasks>

<verification>
```bash
# TypeScript compilation
npx tsc --noEmit

# Verify both files created and properly structured
ls -la src/services/urlParser/groupUtils.ts src/components/forms/ParameterGroup.tsx
```
</verification>

<success_criteria>
- extractGroupPrefix correctly identifies "ddcFilter[name]" -> "ddcFilter"
- humanizeGroupName produces readable labels for all common patterns
- ParameterGroup renders collapsible accordion with Headless UI Disclosure
- All groups collapsed by default (per user decision)
- Chevron indicator animates on state change
</success_criteria>

<output>
After completion, create `.planning/phases/09-url-parsing-type-inference/09-04-SUMMARY.md`
</output>
