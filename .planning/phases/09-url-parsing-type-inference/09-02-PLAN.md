---
phase: 09-url-parsing-type-inference
plan: 02
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/services/urlParser/typeInferrer.ts
  - src/services/urlParser/typeInferrer.test.ts
autonomous: true

must_haves:
  truths:
    - "Boolean values (true/false) are detected with HIGH confidence"
    - "Numeric values are detected with HIGH confidence"
    - "ISO date strings are detected as date type"
    - "Email addresses are detected with appropriate confidence"
    - "URLs with http/https prefix are detected with HIGH confidence"
    - "Coordinate pairs within valid ranges are detected"
    - "ZIP codes are only detected when name hints are present"
    - "Unknown patterns fall back to string type"
  artifacts:
    - path: "src/services/urlParser/typeInferrer.ts"
      provides: "Type inference with confidence levels"
      exports: ["inferParameterType", "TypeInferenceResult", "InferredType"]
    - path: "src/services/urlParser/typeInferrer.test.ts"
      provides: "Test coverage for all type detection cases"
      min_lines: 100
  key_links:
    - from: "src/services/urlParser/typeInferrer.ts"
      to: "conservative detection thresholds"
      via: "multi-signal validation (name + value pattern)"
      pattern: "confidence.*HIGH|MEDIUM|LOW"
---

<objective>
Create type inference service that detects parameter types from values with confidence levels.

Purpose: Enable smart input components by detecting dates, emails, URLs, coordinates, and zip codes from raw string values. Conservative detection prevents false positives that destroy user trust.

Output: inferParameterType() function with multi-signal validation returning type and confidence.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-url-parsing-type-inference/09-RESEARCH.md
</context>

<feature>
  <name>Parameter Type Inferrer</name>
  <files>
    src/services/urlParser/typeInferrer.ts
    src/services/urlParser/typeInferrer.test.ts
  </files>
  <behavior>
    Infer parameter types from name and value with confidence levels.

    **Type detection rules (conservative):**

    | Type | Pattern | Confidence | Name Hint Boost |
    |------|---------|------------|-----------------|
    | boolean | exact "true" or "false" | HIGH | - |
    | number | /^-?\d+(\.\d+)?$/ | HIGH | - |
    | date | ISO 8601, valid parse, year 1970-2100 | MEDIUM -> HIGH | date/time/created/updated/timestamp |
    | email | /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/ | MEDIUM -> HIGH | email/mail |
    | url | /^https?:\/\// | HIGH | - |
    | coordinates | lat,lng in valid range (-90 to 90, -180 to 180) | LOW -> HIGH | coord/lat/lng/location/position |
    | zip | /^\d{5}(-\d{4})?$/ | SKIP -> HIGH | zip/postal/code (REQUIRED) |
    | string | default fallback | HIGH | - |

    **Key principle:** When confidence would be LOW without name hint, prefer string fallback. Only use specialized type when confidence >= MEDIUM.

    **Input -> Output examples:**
    - ("status", "true") -> {type: "boolean", confidence: "HIGH"}
    - ("count", "42") -> {type: "number", confidence: "HIGH"}
    - ("startDate", "2024-01-15") -> {type: "date", confidence: "HIGH"} (name hint)
    - ("foo", "2024-01-15") -> {type: "date", confidence: "MEDIUM"} (pattern only)
    - ("email", "user@example.com") -> {type: "email", confidence: "HIGH"}
    - ("contact", "user@example.com") -> {type: "email", confidence: "MEDIUM"}
    - ("website", "https://example.com") -> {type: "url", confidence: "HIGH"}
    - ("location", "40.7128,-74.0060") -> {type: "coordinates", confidence: "HIGH"}
    - ("foo", "40.7128,-74.0060") -> {type: "string", confidence: "HIGH"} (no name hint, too risky)
    - ("zipCode", "10001") -> {type: "zip", confidence: "HIGH"}
    - ("id", "10001") -> {type: "string", confidence: "HIGH"} (no zip hint)
    - ("foo", "bar") -> {type: "string", confidence: "HIGH"}
    - ("foo", undefined) -> {type: "string", confidence: "HIGH"}
  </behavior>
  <implementation>
    1. Create TypeInferenceResult interface with type, confidence, reasons[]
    2. Create InferredType union: 'string' | 'number' | 'boolean' | 'date' | 'email' | 'url' | 'coordinates' | 'zip'
    3. Implement inferParameterType(name: string, value: string | undefined): TypeInferenceResult
    4. Check types in order: boolean -> number -> date -> email -> url -> coordinates -> zip -> string
    5. Use multi-signal validation: require name hint for risky types (coordinates, zip)
    6. Date validation: ISO pattern + Date.parse() success + year range check
    7. Coordinate validation: parse lat/lng, check -90<=lat<=90, -180<=lng<=180
    8. Return reasons[] for debugging (not shown in UI per user decision)
  </implementation>
</feature>

<verification>
```bash
npm test -- src/services/urlParser/typeInferrer.test.ts
```

All tests must pass covering:
- Boolean exact match (true/false only, not "yes"/"no")
- Number detection (integers, decimals, negatives)
- Date detection with and without name hints
- Invalid dates rejected (bad format, invalid date, out of range year)
- Email detection with and without name hints
- URL detection (http/https required)
- Coordinate detection with name hint required for HIGH confidence
- ZIP detection only with name hint (no false positives on 5-digit numbers)
- String fallback for unknown patterns
- Undefined value handling
</verification>

<success_criteria>
- inferParameterType() returns correct type for all test cases
- Confidence levels follow the conservative rules
- No false positives for risky types (coordinates, zip) without name hints
- Date validation rejects invalid dates and out-of-range years
- Tests cover edge cases and boundary conditions
</success_criteria>

<output>
After completion, create `.planning/phases/09-url-parsing-type-inference/09-02-SUMMARY.md`
</output>
