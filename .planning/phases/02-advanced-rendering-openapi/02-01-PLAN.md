---
phase: 02-advanced-rendering-openapi
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/renderers/TableRenderer.tsx
  - src/components/detail/DetailModal.tsx
  - src/components/renderers/DetailRenderer.tsx
  - src/components/DynamicRenderer.tsx
  - src/types/components.ts
autonomous: true

must_haves:
  truths:
    - "User can click a row in a table to open a detail modal showing that item's full data"
    - "Nested objects and arrays within a detail view render as collapsible sections"
    - "Deep nesting beyond MAX_DEPTH collapses to JSON fallback"
    - "Modal closes via Esc key, outside click, or close button"
  artifacts:
    - path: "src/components/detail/DetailModal.tsx"
      provides: "Modal container for item detail view"
      min_lines: 30
    - path: "src/components/renderers/TableRenderer.tsx"
      provides: "Click handler on table rows opening detail modal"
      contains: "onClick"
    - path: "src/components/renderers/DetailRenderer.tsx"
      provides: "Collapsible sections for nested objects/arrays using Disclosure"
      contains: "Disclosure"
  key_links:
    - from: "src/components/renderers/TableRenderer.tsx"
      to: "src/components/detail/DetailModal.tsx"
      via: "selectedItem state passed to DetailModal"
      pattern: "selectedItem"
    - from: "src/components/detail/DetailModal.tsx"
      to: "src/components/DynamicRenderer.tsx"
      via: "Renders selected item via DynamicRenderer at depth=0"
      pattern: "DynamicRenderer"
    - from: "src/components/renderers/DetailRenderer.tsx"
      to: "@headlessui/react"
      via: "Disclosure component for collapsible nested fields"
      pattern: "Disclosure"
---

<objective>
Add master-detail navigation and collapsible nested data rendering.

Purpose: Users can click any table row to see a full detail view in a modal, with nested objects/arrays displayed as collapsible sections. This addresses RND-03 (master-detail) and RND-04 (nested data with configurable depth).

Output: DetailModal component, updated TableRenderer with row click, updated DetailRenderer with collapsible Disclosure sections.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/components/renderers/TableRenderer.tsx
@src/components/renderers/DetailRenderer.tsx
@src/components/DynamicRenderer.tsx
@src/components/registry/ComponentRegistry.tsx
@src/types/components.ts
@src/types/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Headless UI and create DetailModal component</name>
  <files>
    package.json
    src/components/detail/DetailModal.tsx
  </files>
  <action>
    1. Run `npm install @headlessui/react` to add Headless UI (Dialog, Disclosure).

    2. Create `src/components/detail/DetailModal.tsx`:
       - Import `Dialog`, `DialogPanel`, `DialogTitle` from `@headlessui/react`.
       - Props: `item: unknown | null`, `schema: TypeSignature` (the item schema, not the array schema), `onClose: () => void`.
       - `open` state is derived: `open={item !== null}`.
       - Render a fixed backdrop (`<div className="fixed inset-0 bg-black/30" aria-hidden="true" />`).
       - Center the DialogPanel: `max-w-3xl w-full bg-white rounded-xl shadow-lg p-6 max-h-[80vh] overflow-y-auto`.
       - DialogTitle: Try to derive a title from the item (use first string field value, or "Item Details" fallback). Implementation: if item is an object, check for common name fields (name, title, label, id) and use first found.
       - Body: Render `<DynamicRenderer data={item} schema={schema} path="$.selected" depth={0} />` — NOTE: depth resets to 0 so the detail view gets full depth budget.
       - Close button at bottom: `<button onClick={onClose} className="mt-6 px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Close</button>`.
       - Dialog handles focus trap, Esc, and outside click automatically via Headless UI.
  </action>
  <verify>
    Run `npx tsc --noEmit` — no type errors. Verify `@headlessui/react` is in package.json dependencies.
  </verify>
  <done>
    DetailModal component exists, accepts item/schema/onClose props, renders DynamicRenderer inside a Headless UI Dialog with backdrop, scrollable panel, and close button.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add row click to TableRenderer and collapsible sections to DetailRenderer</name>
  <files>
    src/components/renderers/TableRenderer.tsx
    src/components/renderers/DetailRenderer.tsx
    src/components/DynamicRenderer.tsx
  </files>
  <action>
    **TableRenderer changes:**
    1. Add `useState` for `selectedItem: unknown | null` (initially null).
    2. Add `onClick={() => setSelectedItem(item)}` to each row div. Add `cursor-pointer hover:bg-blue-50` to row classes (replace existing hover if any).
    3. Import and render `DetailModal` at bottom of return:
       ```
       <DetailModal
         item={selectedItem}
         schema={schema.items}
         onClose={() => setSelectedItem(null)}
       />
       ```
       Note: `schema.items` gives the object schema for each array item.
    4. Keep existing row alternating colors, but add hover state.

    **DetailRenderer changes:**
    1. Import `Disclosure`, `DisclosureButton`, `DisclosurePanel` from `@headlessui/react`.
    2. For each field: if `fieldDef.type.kind === 'primitive'`, render inline with PrimitiveRenderer (unchanged).
    3. For non-primitive fields (object or array): wrap in a `Disclosure` component instead of rendering DynamicRenderer inline.
       - `DisclosureButton`: Show field label + type summary (e.g., "addresses (3 items)" for arrays, "metadata (object)" for objects). Use chevron icon that rotates when open. Classes: `flex items-center gap-2 text-blue-600 hover:text-blue-800 text-sm font-medium`.
       - `DisclosurePanel`: Render `<DynamicRenderer>` for the field value inside a bordered container (`ml-4 mt-2 border-l-2 border-gray-200 pl-4`).
       - Default open for depth=0 nested fields (first level of detail). Default closed for depth>=1.
    4. Add a chevron SVG icon component (inline or extracted):
       ```tsx
       <svg className="w-4 h-4 transition-transform ui-open:rotate-180" fill="currentColor" viewBox="0 0 20 20">
         <path fillRule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clipRule="evenodd" />
       </svg>
       ```
       Headless UI adds `ui-open` data attribute for Tailwind to style open state.

    **DynamicRenderer — no changes needed** (existing MAX_DEPTH=5 and JsonFallback handle depth limits already).
  </action>
  <verify>
    1. Run `npx tsc --noEmit` — no type errors.
    2. Run `npm run build` — build succeeds.
    3. Run `npm run dev` and test manually: open browser, fetch a JSON API with nested data (e.g., `https://jsonplaceholder.typicode.com/users`), click a table row — modal should open with detail view. Nested objects (address, company) should show as collapsible sections.
  </verify>
  <done>
    Table rows are clickable and open a detail modal. Detail view shows primitive fields inline and nested objects/arrays as collapsible Disclosure sections. Deep nesting beyond MAX_DEPTH falls back to JSON display.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` succeeds
3. Table rows show pointer cursor and hover highlight
4. Clicking a row opens a modal with full item details
5. Modal has backdrop, centered panel, close button
6. Modal closes via Esc, outside click, or close button
7. Nested objects/arrays in detail view show as collapsible sections with chevron
8. Collapsible sections expand/collapse on click
9. At depth > MAX_DEPTH, content falls back to JSON display
</verification>

<success_criteria>
- DetailModal renders selected item in accessible Headless UI Dialog
- TableRenderer rows are clickable and open DetailModal
- DetailRenderer uses Disclosure for nested fields with expand/collapse
- Build passes, no type errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-advanced-rendering-openapi/02-01-SUMMARY.md`
</output>
