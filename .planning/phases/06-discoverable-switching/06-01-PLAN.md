---
phase: 06-discoverable-switching
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/config/ViewModeBadge.tsx
  - src/components/DynamicRenderer.tsx
autonomous: true

must_haves:
  truths:
    - "Hovering over any renderer area reveals a subtle badge showing the current component type"
    - "Clicking the badge cycles through available component types with the actual renderer swapping in-place — this IS the live preview (DSC-02): the real renderer with real data swaps live, showing an actual preview of each component type"
    - "After ~2 seconds of inactivity the cycled selection auto-confirms and persists to configStore"
    - "Badge appears on ALL renderers including those with no alternatives (dimmed/disabled when no switch options)"
    - "Badge is visible in both View mode and Configure mode"
    - "The existing ComponentPicker modal remains accessible from ConfigPanel's ComponentOverridePanel for detailed side-by-side comparison — the carousel badge is the quick-access mechanism, not a replacement"
  artifacts:
    - path: "src/components/config/ViewModeBadge.tsx"
      provides: "Hover badge with carousel cycling and auto-confirm logic"
      exports: ["ViewModeBadge"]
    - path: "src/components/DynamicRenderer.tsx"
      provides: "Integration of ViewModeBadge in both view and configure modes"
  key_links:
    - from: "src/components/config/ViewModeBadge.tsx"
      to: "src/store/configStore.ts"
      via: "onSelect callback calling setFieldComponentType"
      pattern: "onSelect.*setFieldComponentType"
    - from: "src/components/DynamicRenderer.tsx"
      to: "src/components/config/ViewModeBadge.tsx"
      via: "ViewModeBadge rendered inside DynamicRenderer"
      pattern: "<ViewModeBadge"
---

<objective>
Create a ViewModeBadge component that appears on hover over any renderer and enables carousel-style component type switching. Integrate it into DynamicRenderer so it works in both View and Configure modes.

Purpose: Enables users to discover and switch component types (table/cards/list) without entering Configure mode, making the switching capability discoverable in context (DSC-01, DSC-02).
Output: ViewModeBadge component + updated DynamicRenderer with hover badge in all modes.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/DynamicRenderer.tsx
@src/components/config/ComponentPicker.tsx
@src/store/configStore.ts
@src/types/config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ViewModeBadge component with carousel cycling and auto-confirm</name>
  <files>src/components/config/ViewModeBadge.tsx</files>
  <action>
    Create ViewModeBadge.tsx in src/components/config/ with the following behavior:

    Props interface:
    - currentType: string (the active component type name)
    - availableTypes: string[] (all valid types for this renderer)
    - onSelect: (type: string) => void (callback when selection is confirmed)

    Component behavior:
    1. Display a pill/button showing `{currentType} ▾` (or just `{currentType}` when disabled)
    2. Track a `tempSelection` state initialized from currentType
    3. On click, cycle to next type in availableTypes array (wrapping around): `(currentIndex + 1) % availableTypes.length`
    4. Update badge label in real-time as user cycles
    5. After each cycle click, start/reset a ~2000ms setTimeout timer
    6. When timer fires, call onSelect(tempSelection) to confirm the change
    7. Clean up timer in useEffect return and on unmount (store timer ID in useRef)

    Styling (Tailwind):
    - Base: `bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-medium transition-all`
    - When hasAlternatives (availableTypes.length > 1): `hover:bg-blue-200 cursor-pointer`
    - When !hasAlternatives: `opacity-50 cursor-not-allowed` and disable click handler
    - Position absolutely in top-right of parent: `absolute top-2 right-2 z-10`

    Important:
    - When tempSelection !== currentType (user has cycled but not confirmed), add a subtle visual indicator (e.g., ring-2 ring-blue-300 animate-pulse) to signal pending confirmation
    - Reset tempSelection to currentType if currentType prop changes externally (useEffect sync)
    - The badge label should capitalize the type name for display
  </action>
  <verify>
    - File exists at src/components/config/ViewModeBadge.tsx
    - TypeScript compiles: `npx tsc --noEmit`
    - Component exports ViewModeBadge
    - Has useRef for timer cleanup
    - Has useEffect for timer management and prop sync
  </verify>
  <done>ViewModeBadge component renders a pill showing current type, cycles through alternatives on click, and auto-confirms after ~2s delay with proper timer cleanup</done>
</task>

<task type="auto">
  <name>Task 2: Integrate ViewModeBadge into DynamicRenderer for all modes</name>
  <files>src/components/DynamicRenderer.tsx</files>
  <action>
    Modify DynamicRenderer.tsx to:

    1. Replace the existing configure-mode-only badge with ViewModeBadge that works in ALL modes:
       - Remove the `const showBadge = isConfigureMode && availableTypes.length > 1` logic
       - Add `const [showBadge, setShowBadge] = useState(false)` for hover visibility
       - Wrap the renderer in onMouseEnter/onMouseLeave to toggle showBadge

    2. Render ViewModeBadge conditionally on hover:
       ```
       {showBadge && (
         <ViewModeBadge
           currentType={currentType}
           availableTypes={availableTypes}
           onSelect={(type) => {
             setFieldComponentType(path, type)
           }}
         />
       )}
       ```

    3. Keep the existing ComponentPicker modal: when in Configure mode, clicking the badge still opens the full ComponentPicker modal (the ViewModeBadge carousel is the quick-switch; the modal remains for detailed preview). Modify behavior:
       - In View mode: badge click cycles (carousel pattern from ViewModeBadge)
       - In Configure mode: badge click ALSO cycles (same behavior in both modes per user decision)
       - The ComponentPicker modal can still be opened from ComponentOverridePanel in ConfigPanel

    4. Badge should show for ALL renderers including those with no alternatives (ViewModeBadge handles dimmed state internally via availableTypes.length check)

    5. Import ViewModeBadge from './config/ViewModeBadge'

    Important: Do NOT show badge on depth > 0 renderers (nested sub-renderers) to avoid visual clutter. Only show on top-level renderer (depth === 0).
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - DynamicRenderer imports ViewModeBadge
    - Hover state controls badge visibility
    - Badge renders for depth === 0 only
    - setFieldComponentType called on carousel confirm
  </verify>
  <done>DynamicRenderer shows hover badge in all modes (view and configure) with carousel cycling, only on top-level renderers</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` succeeds
3. ViewModeBadge.tsx exists and exports ViewModeBadge component
4. DynamicRenderer.tsx imports and renders ViewModeBadge on hover
5. Badge visible in both View and Configure mode when hovering over renderer
6. Badge dimmed/disabled for renderers with no alternatives (e.g., primitive)
7. Clicking badge cycles through table -> card-list -> list -> json (for array data)
8. Auto-confirm fires ~2 seconds after last click
</verification>

<success_criteria>
- Hovering over any top-level renderer shows a subtle badge with the current component type name
- Clicking the badge cycles through alternatives in-place with the renderer swapping live
- Selection auto-confirms after ~2s and persists to configStore
- Badge appears dimmed when no alternatives exist
- Works in both View and Configure modes
</success_criteria>

<output>
After completion, create `.planning/phases/06-discoverable-switching/06-01-SUMMARY.md`
</output>
