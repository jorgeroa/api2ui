---
phase: 06-discoverable-switching
plan: 03
type: execute
wave: 2
depends_on: ["06-02"]
files_modified:
  - src/components/config/OnboardingTooltip.tsx
  - src/components/config/ConfigPanel.tsx
  - src/components/config/FieldListPanel.tsx
  - src/components/DynamicRenderer.tsx
autonomous: true

must_haves:
  truths:
    - "One-time onboarding tooltip appears after first data load saying 'Right-click any field to customize it'"
    - "Tooltip is dismissed permanently after user clicks 'Got it' (persisted via localStorage)"
    - "ConfigPanel field rows have a link/button that opens FieldConfigPopover for that field in context"
    - "FieldConfigPopover has a 'More settings...' link that opens ConfigPanel scrolled to the relevant field"
  artifacts:
    - path: "src/components/config/OnboardingTooltip.tsx"
      provides: "One-time discovery tooltip for right-click feature"
      exports: ["OnboardingTooltip"]
    - path: "src/components/config/ConfigPanel.tsx"
      provides: "Cross-navigation links from field rows to contextual popover"
    - path: "src/components/config/FieldListPanel.tsx"
      provides: "Per-field 'Configure in context' button and data-field-path attributes for scroll targeting"
  key_links:
    - from: "src/components/config/OnboardingTooltip.tsx"
      to: "localStorage"
      via: "Persistence of dismissed state"
      pattern: "localStorage.*onboarding"
    - from: "src/components/config/FieldListPanel.tsx"
      to: "src/components/config/ConfigPanel.tsx"
      via: "data-field-path attributes enable scroll-to-field cross-navigation"
      pattern: "data-field-path|scrollIntoView"
---

<objective>
Add cross-navigation between ConfigPanel and FieldConfigPopover, and a one-time onboarding tooltip that teaches users about right-click field customization.

Purpose: Completes the discoverable configuration story with bidirectional navigation between bulk config (ConfigPanel) and contextual config (popover), plus initial discovery guidance (DSC-04).
Output: OnboardingTooltip component, updated ConfigPanel and FieldListPanel with cross-navigation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-discoverable-switching/06-02-SUMMARY.md
@src/components/config/ConfigPanel.tsx
@src/components/config/FieldListPanel.tsx
@src/components/config/FieldConfigPopover.tsx
@src/components/DynamicRenderer.tsx
@src/store/configStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OnboardingTooltip and add cross-navigation to ConfigPanel/FieldListPanel</name>
  <files>src/components/config/OnboardingTooltip.tsx, src/components/config/ConfigPanel.tsx, src/components/config/FieldListPanel.tsx</files>
  <action>
    **1. Create src/components/config/OnboardingTooltip.tsx:**

    Simple one-time tooltip component:
    - Check localStorage key 'api2ui-onboarding-field-config' on mount
    - If already dismissed ('true'), render null
    - If not dismissed, show after a 3-second delay (setTimeout) from mount
    - Render a small floating tooltip near the data area:
      - Fixed position at bottom-center of viewport (e.g., `fixed bottom-8 left-1/2 -translate-x-1/2`)
      - Tailwind: `bg-blue-600 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 z-40`
      - Text: "Right-click any field to customize it"
      - "Got it" button: `bg-white/20 hover:bg-white/30 text-white px-3 py-1 rounded text-sm`
    - On "Got it" click: set localStorage key to 'true' and hide
    - Clean up setTimeout on unmount
    - Single focused message, no multi-step tour

    **2. Update src/components/config/FieldListPanel.tsx:**

    Add cross-navigation capabilities:
    a. Add `data-field-path={field.path}` attribute to each field row div (enables scroll-to-field targeting)
    b. Add a small "configure in context" icon button to each field row:
       - Small gear or pencil icon (SVG inline, ~4x4)
       - On click: dispatch a custom event or call a callback prop to signal "open popover for this field"
       - Tooltip: "Configure in context"
    c. Accept new optional prop: `onConfigureField?: (fieldPath: string) => void`
    d. When this button is clicked, call onConfigureField(field.path)

    **3. Update src/components/config/ConfigPanel.tsx:**

    Add scroll-to-field capability:
    a. Add a `scrollToField` function that uses `document.querySelector('[data-field-path="..."]')` + `scrollIntoView({ behavior: 'smooth', block: 'center' })` with temporary highlight ring
    b. Accept and pass through the scrollToField as a ref or context so FieldConfigPopover's "More settings..." link can call it
    c. Pass an `onConfigureField` prop to FieldListPanel
    d. When FieldListPanel triggers onConfigureField: close ConfigPanel, then the parent component should open FieldConfigPopover for that field (this requires coordination - use a simple approach: store the field path in configStore or a lightweight context, and the renderer picks it up to open the popover)

    Simpler approach for cross-navigation:
    - Add a `pendingFieldConfig` state to configStore (or use a simple event emitter pattern):
      - ConfigPanel sets `pendingFieldConfig = fieldPath` and closes panel
      - DynamicRenderer/renderers check for pendingFieldConfig and open popover
    - OR use a custom DOM event pattern: `document.dispatchEvent(new CustomEvent('api2ui:configure-field', { detail: { fieldPath } }))`

    Use the custom event approach - it's simpler and avoids store pollution:
    - FieldListPanel dispatches 'api2ui:configure-field' event with fieldPath
    - FieldConfigPopover's "More settings..." dispatches 'api2ui:open-config-panel' event with fieldPath
    - ConfigPanel listens for 'api2ui:open-config-panel' and opens + scrolls to field
    - Renderers listen for 'api2ui:configure-field' and open popover for matching field

    Important: The cross-navigation is bidirectional:
    - ConfigPanel field row -> click "configure in context" -> closes panel, opens popover on that field in the renderer
    - FieldConfigPopover "More settings..." -> closes popover, opens ConfigPanel scrolled to that field
  </action>
  <verify>
    - All three files exist/updated
    - `npx tsc --noEmit` passes
    - OnboardingTooltip checks localStorage on mount
    - FieldListPanel has data-field-path attributes on field rows
    - ConfigPanel has scroll-to-field function
  </verify>
  <done>OnboardingTooltip shows once after data loads; ConfigPanel field rows link to contextual popover; FieldConfigPopover links back to ConfigPanel with scroll-to-field</done>
</task>

<task type="auto">
  <name>Task 2: Wire OnboardingTooltip and cross-navigation events into DynamicRenderer</name>
  <files>src/components/DynamicRenderer.tsx</files>
  <action>
    Update DynamicRenderer.tsx to:

    1. Render OnboardingTooltip:
       - Import OnboardingTooltip from './config/OnboardingTooltip'
       - Render it once at the top-level (only when depth === 0 and data is present)
       - It handles its own show/hide logic and localStorage persistence

    2. Listen for 'api2ui:configure-field' custom events:
       - Add a useEffect that listens for the custom event on document
       - When received, extract fieldPath from event.detail
       - This is for the ConfigPanel -> popover cross-navigation
       - Store the fieldPath in local state to signal child renderers
       - Pass a prop or use a context to tell child renderers to open popover for that field

    Simpler alternative: Since each renderer manages its own popover state, the custom event listener should live in the renderers themselves (from Plan 02). Instead, just add the OnboardingTooltip rendering here and ensure the "More settings..." link from FieldConfigPopover dispatches the right event.

    Focus this task on:
    a. Import and render OnboardingTooltip at depth === 0
    b. Ensure the "More settings..." link in FieldConfigPopover (from Plan 02) receives the onOpenConfigPanel callback that dispatches 'api2ui:open-config-panel' and opens the ConfigPanel
    c. In ConfigPanel (already updated in Task 1), listen for 'api2ui:open-config-panel' events and scroll to the field

    Wire the onOpenConfigPanel callback through the renderer -> FieldConfigPopover chain:
    - DynamicRenderer passes a handleOpenConfigPanel function to child renderers (or provide via a small context)
    - handleOpenConfigPanel: opens ConfigPanel (togglePanel) and dispatches scroll event
    - The renderers pass this to FieldConfigPopover's onOpenConfigPanel prop

    If adding a context feels heavy, use the DOM event pattern consistently:
    - FieldConfigPopover's "More settings..." dispatches: `document.dispatchEvent(new CustomEvent('api2ui:open-config-panel', { detail: { fieldPath } }))`
    - ConfigPanel's useEffect listens for this event, opens panel if closed, and scrolls to field after a short delay (to allow panel to render)
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `npm run build` succeeds
    - DynamicRenderer renders OnboardingTooltip at depth 0
    - Cross-navigation events fire correctly
    - ConfigPanel responds to open-config-panel events
  </verify>
  <done>OnboardingTooltip renders on first data load; cross-navigation works bidirectionally between ConfigPanel and FieldConfigPopover via custom DOM events</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` succeeds
3. OnboardingTooltip.tsx exists and renders once after first data load
4. Tooltip dismissed permanently via localStorage
5. FieldListPanel field rows have data-field-path attributes
6. ConfigPanel scrolls to field when cross-navigated
7. "More settings..." in popover opens ConfigPanel at correct field
8. "Configure in context" in ConfigPanel closes panel and signals renderer to open popover
</verification>

<success_criteria>
- One-time tooltip appears 3s after first data load with "Right-click any field to customize it"
- Tooltip dismissed permanently after clicking "Got it"
- ConfigPanel field rows have link to open contextual popover
- FieldConfigPopover has "More settings..." link to open ConfigPanel at that field
- Bidirectional cross-navigation works reliably
</success_criteria>

<output>
After completion, create `.planning/phases/06-discoverable-switching/06-03-SUMMARY.md`
</output>
