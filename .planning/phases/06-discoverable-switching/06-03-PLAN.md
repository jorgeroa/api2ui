---
phase: 06-discoverable-switching
plan: 03
type: execute
wave: 2
depends_on: ["06-02"]
files_modified:
  - src/components/config/OnboardingTooltip.tsx
  - src/components/config/ConfigPanel.tsx
  - src/components/config/FieldListPanel.tsx
  - src/components/DynamicRenderer.tsx
  - src/components/renderers/TableRenderer.tsx
  - src/components/renderers/CardListRenderer.tsx
  - src/components/renderers/DetailRenderer.tsx
  - src/components/renderers/ListRenderer.tsx
autonomous: true

must_haves:
  truths:
    - "One-time onboarding tooltip appears after first data load saying 'Right-click any field to customize it'"
    - "Tooltip is dismissed permanently after user clicks 'Got it' (persisted via localStorage)"
    - "ConfigPanel field rows have a link/button that opens FieldConfigPopover for that field in context"
    - "FieldConfigPopover has a 'More settings...' link that opens ConfigPanel scrolled to the relevant field"
  artifacts:
    - path: "src/components/config/OnboardingTooltip.tsx"
      provides: "One-time discovery tooltip for right-click feature"
      exports: ["OnboardingTooltip"]
    - path: "src/components/config/ConfigPanel.tsx"
      provides: "Cross-navigation links from field rows to contextual popover"
    - path: "src/components/config/FieldListPanel.tsx"
      provides: "Per-field 'Configure in context' button and data-field-path attributes for scroll targeting"
  key_links:
    - from: "src/components/config/OnboardingTooltip.tsx"
      to: "localStorage"
      via: "Persistence of dismissed state"
      pattern: "localStorage.*onboarding"
    - from: "src/components/config/FieldListPanel.tsx"
      to: "src/components/config/ConfigPanel.tsx"
      via: "data-field-path attributes enable scroll-to-field cross-navigation"
      pattern: "data-field-path|scrollIntoView"
---

<objective>
Add cross-navigation between ConfigPanel and FieldConfigPopover, and a one-time onboarding tooltip that teaches users about right-click field customization.

Purpose: Completes the discoverable configuration story with bidirectional navigation between bulk config (ConfigPanel) and contextual config (popover), plus initial discovery guidance (DSC-04).
Output: OnboardingTooltip component, updated ConfigPanel and FieldListPanel with cross-navigation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-discoverable-switching/06-02-SUMMARY.md
@src/components/config/ConfigPanel.tsx
@src/components/config/FieldListPanel.tsx
@src/components/config/FieldConfigPopover.tsx
@src/components/DynamicRenderer.tsx
@src/store/configStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OnboardingTooltip and add cross-navigation to ConfigPanel/FieldListPanel</name>
  <files>src/components/config/OnboardingTooltip.tsx, src/components/config/ConfigPanel.tsx, src/components/config/FieldListPanel.tsx</files>
  <action>
    **1. Create src/components/config/OnboardingTooltip.tsx:**

    Simple one-time tooltip component:
    - Check localStorage key 'api2ui-onboarding-field-config' on mount
    - If already dismissed ('true'), render null
    - If not dismissed, show after a 3-second delay (setTimeout) from mount
    - Render a small floating tooltip near the data area:
      - Fixed position at bottom-center of viewport (e.g., `fixed bottom-8 left-1/2 -translate-x-1/2`)
      - Tailwind: `bg-blue-600 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 z-40`
      - Text: "Right-click any field to customize it"
      - "Got it" button: `bg-white/20 hover:bg-white/30 text-white px-3 py-1 rounded text-sm`
    - On "Got it" click: set localStorage key to 'true' and hide
    - Clean up setTimeout on unmount
    - Single focused message, no multi-step tour

    **2. Update src/components/config/FieldListPanel.tsx:**

    Add cross-navigation capabilities:
    a. Add `data-field-path={field.path}` attribute to each field row div (enables scroll-to-field targeting)
    b. Add a small "configure in context" icon button to each field row:
       - Small gear or pencil icon (SVG inline, ~4x4)
       - On click: dispatch a custom event or call a callback prop to signal "open popover for this field"
       - Tooltip: "Configure in context"
    c. Accept new optional prop: `onConfigureField?: (fieldPath: string) => void`
    d. When this button is clicked, call onConfigureField(field.path)

    **3. Update src/components/config/ConfigPanel.tsx:**

    Add scroll-to-field capability:
    a. Add a `scrollToField` function that uses `document.querySelector('[data-field-path="..."]')` + `scrollIntoView({ behavior: 'smooth', block: 'center' })` with temporary highlight ring
    b. Accept and pass through the scrollToField as a ref or context so FieldConfigPopover's "More settings..." link can call it
    c. Pass an `onConfigureField` prop to FieldListPanel
    d. When FieldListPanel triggers onConfigureField: close ConfigPanel, then the parent component should open FieldConfigPopover for that field (this requires coordination - use a simple approach: store the field path in configStore or a lightweight context, and the renderer picks it up to open the popover)

    Simpler approach for cross-navigation:
    - Add a `pendingFieldConfig` state to configStore (or use a simple event emitter pattern):
      - ConfigPanel sets `pendingFieldConfig = fieldPath` and closes panel
      - DynamicRenderer/renderers check for pendingFieldConfig and open popover
    - OR use a custom DOM event pattern: `document.dispatchEvent(new CustomEvent('api2ui:configure-field', { detail: { fieldPath } }))`

    Use the custom event approach - it's simpler and avoids store pollution:
    - FieldListPanel dispatches 'api2ui:configure-field' event with fieldPath
    - FieldConfigPopover's "More settings..." dispatches 'api2ui:open-config-panel' event with fieldPath
    - ConfigPanel listens for 'api2ui:open-config-panel' and opens + scrolls to field
    - Renderers listen for 'api2ui:configure-field' and open popover for matching field

    Important: The cross-navigation is bidirectional:
    - ConfigPanel field row -> click "configure in context" -> closes panel, opens popover on that field in the renderer
    - FieldConfigPopover "More settings..." -> closes popover, opens ConfigPanel scrolled to that field
  </action>
  <verify>
    - All three files exist/updated
    - `npx tsc --noEmit` passes
    - OnboardingTooltip checks localStorage on mount
    - FieldListPanel has data-field-path attributes on field rows
    - ConfigPanel has scroll-to-field function
  </verify>
  <done>OnboardingTooltip shows once after data loads; ConfigPanel field rows link to contextual popover; FieldConfigPopover links back to ConfigPanel with scroll-to-field</done>
</task>

<task type="auto">
  <name>Task 2: Wire OnboardingTooltip, cross-navigation events into DynamicRenderer and renderers</name>
  <files>src/components/DynamicRenderer.tsx, src/components/renderers/TableRenderer.tsx, src/components/renderers/CardListRenderer.tsx, src/components/renderers/DetailRenderer.tsx, src/components/renderers/ListRenderer.tsx</files>
  <action>
    **1. Update DynamicRenderer.tsx:**

    a. Import and render OnboardingTooltip:
       - Import OnboardingTooltip from './config/OnboardingTooltip'
       - Render it once at the top-level (only when depth === 0 and data is present)
       - It handles its own show/hide logic and localStorage persistence

    **2. Add 'api2ui:configure-field' event listeners to all four renderers (from Plan 06-02):**

    Each renderer (TableRenderer, CardListRenderer, DetailRenderer, ListRenderer) was modified in Plan 06-02 to have popoverState and FieldConfigPopover rendering. This task extends those same renderers to also listen for the cross-navigation event:

    For each of the four renderer files:
    a. Add a useEffect that listens for 'api2ui:configure-field' custom events on document
    b. When received, extract fieldPath from event.detail
    c. Check if fieldPath matches any field this renderer owns
    d. If it matches, set popoverState to open the FieldConfigPopover for that field
       - Position the popover near the field element (use the field's getBoundingClientRect() to compute position)
       - This enables the ConfigPanel -> popover cross-navigation direction
    e. Clean up event listener on unmount

    Pattern for each renderer:
    ```tsx
    useEffect(() => {
      const handler = (e: Event) => {
        const { fieldPath } = (e as CustomEvent).detail
        // Check if this renderer owns this fieldPath
        // If so, find the DOM element with data-field-path, get its rect
        const el = document.querySelector(`[data-field-path="${fieldPath}"]`)
        if (el) {
          const rect = el.getBoundingClientRect()
          setPopoverState({ fieldPath, fieldName: ..., fieldValue: ..., position: { x: rect.right, y: rect.top } })
        }
      }
      document.addEventListener('api2ui:configure-field', handler)
      return () => document.removeEventListener('api2ui:configure-field', handler)
    }, [])
    ```

    **3. Wire the "More settings..." direction (popover -> ConfigPanel):**

    Use the DOM event pattern consistently:
    - FieldConfigPopover's "More settings..." dispatches: `document.dispatchEvent(new CustomEvent('api2ui:open-config-panel', { detail: { fieldPath } }))`
    - ConfigPanel's useEffect (from Task 1) listens for this event, opens panel if closed, and scrolls to field after a short delay (to allow panel to render)
    - No additional wiring needed in DynamicRenderer for this direction since it's handled via DOM events directly between FieldConfigPopover and ConfigPanel
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `npm run build` succeeds
    - DynamicRenderer renders OnboardingTooltip at depth 0
    - All four renderers (TableRenderer, CardListRenderer, DetailRenderer, ListRenderer) have 'api2ui:configure-field' event listeners
    - Cross-navigation events fire correctly in both directions
    - ConfigPanel responds to open-config-panel events
  </verify>
  <done>OnboardingTooltip renders on first data load; all four renderers listen for 'api2ui:configure-field' events to open popover from ConfigPanel; cross-navigation works bidirectionally via custom DOM events</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` succeeds
3. OnboardingTooltip.tsx exists and renders once after first data load
4. Tooltip dismissed permanently via localStorage
5. FieldListPanel field rows have data-field-path attributes
6. ConfigPanel scrolls to field when cross-navigated
7. "More settings..." in popover opens ConfigPanel at correct field
8. "Configure in context" in ConfigPanel closes panel and signals renderer to open popover
</verification>

<success_criteria>
- One-time tooltip appears 3s after first data load with "Right-click any field to customize it"
- Tooltip dismissed permanently after clicking "Got it"
- ConfigPanel field rows have link to open contextual popover
- FieldConfigPopover has "More settings..." link to open ConfigPanel at that field
- Bidirectional cross-navigation works reliably
</success_criteria>

<output>
After completion, create `.planning/phases/06-discoverable-switching/06-03-SUMMARY.md`
</output>
