---
phase: 04-navigation-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/navigation/Sidebar.tsx
  - src/components/navigation/TagGroup.tsx
  - src/components/navigation/OperationItem.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Multi-endpoint OpenAPI specs display a sidebar with operations grouped by tag"
    - "Single-endpoint or direct API URLs render without sidebar (current centered layout)"
    - "Clicking an operation in sidebar selects it and preserves configStore state"
    - "Sidebar shows method badge (GET) and path for each operation"
    - "Tag groups are collapsible via Headless UI Disclosure"
    - "Keyboard users can skip sidebar navigation via skip link"
  artifacts:
    - path: "src/components/navigation/Sidebar.tsx"
      provides: "Sidebar container with tag-grouped navigation"
      min_lines: 40
    - path: "src/components/navigation/TagGroup.tsx"
      provides: "Collapsible tag group using Headless UI Disclosure"
      min_lines: 30
    - path: "src/components/navigation/OperationItem.tsx"
      provides: "Individual operation button with method badge and active state"
      min_lines: 20
    - path: "src/App.tsx"
      provides: "Conditional flex layout with sidebar for multi-endpoint specs"
  key_links:
    - from: "src/components/navigation/OperationItem.tsx"
      to: "appStore.setSelectedOperation"
      via: "onSelect callback prop"
      pattern: "onSelect.*index"
    - from: "src/components/navigation/Sidebar.tsx"
      to: "src/components/navigation/TagGroup.tsx"
      via: "renders TagGroup for each tag in grouped operations"
      pattern: "TagGroup"
    - from: "src/App.tsx"
      to: "src/components/navigation/Sidebar.tsx"
      via: "conditional render when parsedSpec has 2+ operations"
      pattern: "parsedSpec.*operations.*length.*Sidebar"
---

<objective>
Add auto-generated sidebar navigation for multi-endpoint OpenAPI specs with tag-based grouping.

Purpose: Users loading OpenAPI specs with multiple GET endpoints need a persistent sidebar to browse and switch between operations without using a dropdown. This is the primary navigation mechanism for multi-endpoint APIs.

Output: Three new navigation components (Sidebar, TagGroup, OperationItem) and a restructured App.tsx layout that conditionally shows sidebar when a parsed spec has 2+ operations.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-navigation-polish/04-RESEARCH.md

Key source files to read:
@src/App.tsx
@src/store/appStore.ts
@src/services/openapi/types.ts
@src/components/openapi/OperationSelector.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sidebar navigation components</name>
  <files>
    src/components/navigation/OperationItem.tsx
    src/components/navigation/TagGroup.tsx
    src/components/navigation/Sidebar.tsx
  </files>
  <action>
Create three components in a new `src/components/navigation/` directory:

**OperationItem.tsx:**
- Props: `operation: ParsedOperation`, `index: number`, `isSelected: boolean`, `onSelect: (index: number) => void`
- Render a `<button>` with full width, text-left alignment
- Show method badge (green bg, uppercase, small text) + operation path in monospace
- Show operation summary below path if available (truncated, small gray text)
- Active state: `bg-blue-50 border-l-2 border-blue-600 text-blue-700` (or theme-aware `bg-surface` with accent border)
- Inactive hover: `hover:bg-gray-50`
- Use theme-aware classes where appropriate: `text-text`, `bg-surface`, `border-border`

**TagGroup.tsx:**
- Props: `tag: string`, `operations: ParsedOperation[]`, `operationIndices: number[]`, `selectedIndex: number`, `onSelect: (index: number) => void`
- Use Headless UI `Disclosure` component with `defaultOpen` prop
- `DisclosureButton`: flex row with chevron icon (rotates 90deg when open via `data-[open]:rotate-90`) + tag name (font-semibold) + operation count badge
- `DisclosurePanel`: renders `OperationItem` for each operation, using `operationIndices` to pass the correct global index
- Import from `@headlessui/react`: `Disclosure`, `DisclosureButton`, `DisclosurePanel`

**Sidebar.tsx:**
- Props: `parsedSpec: ParsedSpec`, `selectedIndex: number`, `onSelect: (index: number) => void`
- Create a `groupOperationsByTags` helper function (can be inline or extracted):
  - Iterate over `parsedSpec.operations`
  - For each operation, use its `tags` array (fallback to `['Uncategorized']` if empty)
  - Build a `Map<string, number[]>` mapping tag name to array of operation indices
  - Memoize with `useMemo` keyed on `parsedSpec.operations`
- Render `<nav aria-label="API endpoints">` wrapping a `<ul>` of `<li>` elements
- Each `<li>` renders a `TagGroup`
- Show spec title and operation count at the top of sidebar
- Sidebar styling: `w-64 border-r border-border bg-surface overflow-y-auto shrink-0` with full height
- If ALL operations are untagged (all go to Uncategorized), render a flat list without Disclosure grouping (just OperationItem buttons directly)
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors. Check that all three files exist and import correctly.
  </verify>
  <done>
Three navigation components exist, type-check passes, Sidebar groups operations by tags using Headless UI Disclosure, OperationItem shows method badge and path with active state styling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Restructure App.tsx layout with conditional sidebar</name>
  <files>
    src/App.tsx
  </files>
  <action>
Modify App.tsx to conditionally show sidebar navigation for multi-endpoint specs:

**Layout logic:**
- Define `showSidebar` boolean: `parsedSpec !== null && parsedSpec.operations.length >= 2`
- When `showSidebar` is true: use flex layout with sidebar on left and main content on right
- When `showSidebar` is false: keep current centered `max-w-6xl mx-auto` layout

**Skip navigation link:**
- Add as first element inside the root fragment (before ThemeApplier):
  ```
  <a href="#main-content" className="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-50 focus:px-4 focus:py-2 focus:bg-blue-600 focus:text-white focus:rounded">
    Skip to main content
  </a>
  ```

**When sidebar is shown (showSidebar = true):**
- Remove the centered max-w-6xl wrapper and OperationSelector dropdown (sidebar replaces it)
- Layout structure:
  ```
  <div className="flex min-h-screen bg-background text-text">
    <Sidebar parsedSpec={parsedSpec} selectedIndex={selectedOperationIndex} onSelect={setSelectedOperation} />
    <main id="main-content" className="flex-1 overflow-y-auto py-8 px-6">
      {/* Configure mode bar still at top */}
      {/* Header, URLInput (keep centered within main) */}
      {/* Spec info header */}
      {/* ParameterForm for selected operation */}
      {/* Data rendering */}
    </main>
  </div>
  ```
- The configure mode bar should still be fixed at top spanning full width
- URLInput stays at top of main content area
- Keep the spec info header (title, version, specVersion badge)
- ParameterForm shows for selected operation
- DynamicRenderer shows response data

**When sidebar is NOT shown (showSidebar = false):**
- Keep the existing centered layout exactly as-is (no changes to non-sidebar flow)
- This covers: direct API URLs, single-operation specs, no data loaded (welcome state)

**Import Sidebar:**
- `import { Sidebar } from './components/navigation/Sidebar'`

**Key details:**
- The `isConfigureMode` padding (`pt-20`) should apply to main content area in both layouts
- ConfigToggle and ConfigPanel remain outside the layout wrapper (floating elements)
- The configure mode ring (`ring-2 ring-blue-500`) should wrap the main content area in sidebar layout too
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors. Run `npm run dev` and verify:
1. Direct API URL (jsonplaceholder.typicode.com/users) renders WITHOUT sidebar (centered layout)
2. If an OpenAPI spec with multiple endpoints is available, sidebar appears on left
3. Skip link is focusable with Tab key
  </verify>
  <done>
App.tsx conditionally renders sidebar for multi-endpoint specs, preserves centered layout for single endpoints and direct URLs, skip link exists for keyboard navigation, TypeScript compiles without errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` succeeds
3. Direct API URL renders in centered layout without sidebar
4. OpenAPI spec URL with 2+ GET operations renders with sidebar navigation
5. Clicking operation in sidebar selects it (updates selectedOperationIndex)
6. Tag groups are collapsible (Disclosure open/close)
7. Active operation is visually highlighted in sidebar
8. Skip link appears when focused (Tab from top of page)
9. Configurations (fieldConfigs, styleOverrides) persist when switching operations via sidebar
</verification>

<success_criteria>
- Sidebar renders for multi-endpoint OpenAPI specs with operations grouped by tag
- Clicking an operation switches the selected endpoint
- Single-endpoint and direct API URLs use the original centered layout
- Accessible navigation structure with semantic HTML and skip link
- TypeScript compiles, build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/04-navigation-polish/04-01-SUMMARY.md`
</output>
