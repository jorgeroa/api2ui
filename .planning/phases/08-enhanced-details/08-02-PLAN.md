---
phase: 08-enhanced-details
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/detail/DetailPanel.tsx
  - src/types/navigation.ts
  - src/types/config.ts
  - src/components/navigation/DrilldownModeToggle.tsx
  - src/components/renderers/CardListRenderer.tsx
  - src/components/renderers/TableRenderer.tsx
  - src/components/DynamicRenderer.tsx
autonomous: true

must_haves:
  truths:
    - "Breadcrumb navigation appears when drilling into nested detail views"
    - "Card detail view mode is selectable between dialog, panel, and page"
    - "Panel slides in from the right with semi-transparent backdrop"
    - "DrilldownModeToggle shows three options: Page, Dialog, Panel"
  artifacts:
    - path: "src/components/detail/DetailPanel.tsx"
      provides: "Side panel detail view component"
      contains: "DialogPanel"
    - path: "src/types/navigation.ts"
      provides: "Extended DrilldownMode type with panel"
      contains: "panel"
    - path: "src/components/navigation/DrilldownModeToggle.tsx"
      provides: "Three-mode toggle including Panel"
      contains: "panel"
  key_links:
    - from: "src/components/renderers/CardListRenderer.tsx"
      to: "src/components/detail/DetailPanel.tsx"
      via: "conditional render based on drilldownMode"
      pattern: "DetailPanel"
    - from: "src/components/renderers/TableRenderer.tsx"
      to: "src/components/detail/DetailPanel.tsx"
      via: "conditional render based on drilldownMode"
      pattern: "DetailPanel"
    - from: "src/components/DynamicRenderer.tsx"
      to: "src/components/navigation/Breadcrumb.tsx"
      via: "breadcrumb shown when navStack exists"
      pattern: "navStack.length > 0"
---

<objective>
Add a panel (drawer) drilldown mode as a third option alongside page and dialog, and enable breadcrumb navigation in all drilldown modes for nested detail views.

Purpose: Give users flexibility in how they view item details (quick modal vs persistent side panel), and provide clear navigation context when drilling into nested data. This covers requirements DTL-04 and DTL-05.
Output: New DetailPanel.tsx component, extended DrilldownMode type, updated toggle and renderers, breadcrumbs in all modes.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-enhanced-details/08-RESEARCH.md

@src/components/detail/DetailModal.tsx
@src/components/navigation/DrilldownModeToggle.tsx
@src/components/navigation/Breadcrumb.tsx
@src/components/renderers/CardListRenderer.tsx
@src/components/renderers/TableRenderer.tsx
@src/contexts/NavigationContext.tsx
@src/types/navigation.ts
@src/types/config.ts
@src/store/configStore.ts
@src/components/DynamicRenderer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend DrilldownMode type and create DetailPanel component</name>
  <files>
    src/types/navigation.ts
    src/types/config.ts
    src/components/detail/DetailPanel.tsx
    src/components/navigation/DrilldownModeToggle.tsx
  </files>
  <action>
**Extend DrilldownMode type in both files:**

In `src/types/navigation.ts`, change:
```typescript
export type DrilldownMode = 'page' | 'dialog'
```
to:
```typescript
export type DrilldownMode = 'page' | 'dialog' | 'panel'
```

In `src/types/config.ts`, make the same change:
```typescript
export type DrilldownMode = 'page' | 'dialog' | 'panel'
```

Both files define DrilldownMode independently. Both must be updated. The configStore imports from `../types/config`, while NavigationContext imports from `../types/navigation`.

**Create DetailPanel.tsx:**

Create `src/components/detail/DetailPanel.tsx` as a side panel using Headless UI Dialog, positioned at right edge (same structural pattern as DetailModal but with different positioning).

```typescript
import { Dialog, DialogPanel, DialogTitle } from '@headlessui/react'
import type { TypeSignature } from '../../types/schema'
import { DynamicRenderer } from '../DynamicRenderer'
import { getItemLabel } from '../../utils/itemLabel'

interface DetailPanelProps {
  item: unknown | null
  schema: TypeSignature
  onClose: () => void
}

export function DetailPanel({ item, schema, onClose }: DetailPanelProps) {
  const open = item !== null

  return (
    <Dialog open={open} onClose={onClose} className="relative z-50">
      {/* Backdrop - lighter than modal */}
      <div className="fixed inset-0 bg-black/20" aria-hidden="true" />

      {/* Panel container - positioned at right edge */}
      <div className="fixed inset-0 flex justify-end">
        <DialogPanel className="w-full max-w-2xl bg-surface text-text shadow-xl h-full overflow-y-auto">
          {/* Sticky header */}
          <div className="sticky top-0 bg-surface border-b border-border px-6 py-4 flex items-center justify-between z-10">
            <DialogTitle className="text-xl font-semibold">
              {getItemLabel(item, 'Item Details')}
            </DialogTitle>
            <button onClick={onClose} className="text-gray-500 hover:text-gray-700" aria-label="Close panel">
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>

          {/* Panel content */}
          <div className="p-6">
            {item !== null && (
              <DynamicRenderer data={item} schema={schema} path="$.selected" depth={0} />
            )}
          </div>
        </DialogPanel>
      </div>
    </Dialog>
  )
}
```

**Update DrilldownModeToggle.tsx:**

Add a third "Panel" button after the existing "Dialog" button, following the exact same pattern:

```typescript
<button
  onClick={() => setDrilldownMode('panel')}
  className={`px-2.5 py-1 border-l border-gray-300 transition-colors ${
    drilldownMode === 'panel'
      ? 'bg-blue-100 text-blue-800 font-medium'
      : 'bg-white text-gray-600 hover:bg-gray-50'
  }`}
>
  Panel
</button>
```
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors (the DrilldownMode change will surface any type mismatches across the codebase). Run `npx vite build` to confirm successful build.
  </verify>
  <done>
DrilldownMode type includes 'panel' in both type definition files, DetailPanel component exists with right-side drawer layout using Headless UI Dialog with sticky header and close button, DrilldownModeToggle shows three options (Page, Dialog, Panel).
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire DetailPanel into renderers and enable breadcrumbs in all modes</name>
  <files>
    src/components/renderers/CardListRenderer.tsx
    src/components/renderers/TableRenderer.tsx
    src/components/DynamicRenderer.tsx
  </files>
  <action>
**Wire DetailPanel into CardListRenderer.tsx:**

Import `{ DetailPanel }` from `'../detail/DetailPanel'`.

After the existing DetailModal conditional (around line 235), add panel rendering:
```typescript
{/* Detail modal - dialog mode */}
{(!nav || nav.drilldownMode === 'dialog') && (
  <DetailModal item={selectedItem} schema={schema.items} onClose={() => setSelectedItem(null)} />
)}

{/* Detail panel - panel mode */}
{nav && nav.drilldownMode === 'panel' && (
  <DetailPanel item={selectedItem} schema={schema.items} onClose={() => setSelectedItem(null)} />
)}
```

The click handler (line ~119) already works for panel mode - it checks for `nav.drilldownMode === 'page'` and falls through to `setSelectedItem(item)` for all other modes (dialog and panel). No change needed to click handler.

**Wire DetailPanel into TableRenderer.tsx:**

Same pattern. Import `{ DetailPanel }` from `'../detail/DetailPanel'`.

After the existing DetailModal conditional (around line 352), add:
```typescript
{/* Detail panel - panel mode */}
{nav && nav.drilldownMode === 'panel' && (
  <DetailPanel item={selectedItem} schema={schema.items} onClose={() => setSelectedItem(null)} />
)}
```

The click handler already falls through to `setSelectedItem(item)` for non-page modes. No change needed.

**Enable breadcrumbs in all drilldown modes (DynamicRenderer.tsx):**

In `src/components/DynamicRenderer.tsx`, find the breadcrumb display condition at approximately line 139:
```typescript
{isPageMode && navStack.length > 0 ? (
  <Breadcrumb ...
```

Change the condition to show breadcrumbs whenever there's a nav stack, regardless of mode:
```typescript
{navStack.length > 0 ? (
  <Breadcrumb ...
```

This single-line change ensures breadcrumb navigation appears in all three modes (page, dialog, panel) when the user has drilled into nested views. The rest of the breadcrumb rendering logic and the DrilldownModeToggle positioning remain unchanged.

Also, update the `useEffect` that clears the nav stack when switching to dialog mode (around line 64):
```typescript
useEffect(() => {
  if (depth === 0 && drilldownMode === 'dialog') setNavStack([])
}, [drilldownMode, depth])
```
Change to clear for both dialog and panel modes:
```typescript
useEffect(() => {
  if (depth === 0 && (drilldownMode === 'dialog' || drilldownMode === 'panel')) setNavStack([])
}, [drilldownMode, depth])
```
This ensures the nav stack resets when switching away from page mode.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors. Run `npx vite build` to confirm successful build. Test manually:
1. Load an API with array data (e.g., JSONPlaceholder users)
2. Switch to Panel mode via the toggle - verify three buttons show
3. Click a table row or card - verify panel slides in from right
4. Close panel via X button and backdrop click
5. Switch to Page mode, click an item, verify breadcrumb appears
6. Click "Results" breadcrumb to return to list
7. Switch to Dialog mode, verify modal still works as before
  </verify>
  <done>
CardListRenderer and TableRenderer both render DetailPanel in panel mode, breadcrumbs appear in all drilldown modes when nav stack exists, nav stack clears when switching to dialog/panel mode. All three modes (Page, Dialog, Panel) function correctly.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npx vite build` completes successfully
3. DrilldownModeToggle shows Page | Dialog | Panel buttons
4. Panel mode: clicking row/card opens right-side panel with item details
5. Panel has sticky header with title and close button, lighter backdrop (bg-black/20)
6. Panel close via X button and backdrop click both work
7. Page mode drilldown shows breadcrumb trail
8. Breadcrumb links navigate back to parent views
9. Dialog mode still works as before (centered modal)
10. All three modes function correctly for both table and card renderers
</verification>

<success_criteria>
- DTL-04: Breadcrumb navigation appears in all drilldown modes when nav stack exists
- DTL-05: Panel mode is selectable and renders detail in a right-side drawer
- DrilldownModeToggle shows all three options
- Both TableRenderer and CardListRenderer support panel mode
- No regressions in existing page and dialog modes
</success_criteria>

<output>
After completion, create `.planning/phases/08-enhanced-details/08-02-SUMMARY.md`
</output>
