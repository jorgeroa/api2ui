---
phase: 19-auth-configuration-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/auth/LockIcon.tsx
  - src/components/auth/AuthTypeSelector.tsx
  - src/components/auth/CredentialForm.tsx
  - src/components/auth/AuthErrorDisplay.tsx
  - src/components/auth/AuthPanel.tsx
autonomous: true

must_haves:
  truths:
    - "LockIcon renders three visual states: gray (no auth), green (active), red (failed)"
    - "AuthTypeSelector dropdown offers None, API Key, Bearer Token, Basic Auth, Query Parameter"
    - "CredentialForm renders correct fields per auth type (token, username/password, header+value, param+value)"
    - "Credential inputs are masked (password type) with visibility toggle"
    - "AuthErrorDisplay shows distinct messages for 401 vs 403"
    - "AuthPanel wraps everything in a Headless UI Disclosure with controlled open state"
  artifacts:
    - path: "src/components/auth/LockIcon.tsx"
      provides: "Stateful lock icon with color and tooltip"
    - path: "src/components/auth/AuthTypeSelector.tsx"
      provides: "Auth type dropdown with None option"
    - path: "src/components/auth/CredentialForm.tsx"
      provides: "Dynamic credential form per auth type"
    - path: "src/components/auth/AuthErrorDisplay.tsx"
      provides: "Inline auth error messages"
    - path: "src/components/auth/AuthPanel.tsx"
      provides: "Collapsible auth configuration panel"
  key_links:
    - from: "src/components/auth/AuthPanel.tsx"
      to: "src/store/authStore.ts"
      via: "useAuthStore hook"
      pattern: "useAuthStore"
    - from: "src/components/auth/CredentialForm.tsx"
      to: "src/types/auth.ts"
      via: "Credential discriminated union"
      pattern: "Credential|AuthType"
---

<objective>
Create all auth UI components: lock icon with three visual states, auth type dropdown selector, dynamic credential form, inline error display, and the collapsible auth panel container.

Purpose: These components form the complete auth configuration interface that users interact with to set up API credentials. They consume the authStore (Phase 17) and auth types but are standalone — integration into the main app layout happens in Plan 02.

Output: Five new component files in src/components/auth/ that compose into a fully functional auth configuration panel.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-auth-configuration-ui/19-CONTEXT.md
@.planning/phases/19-auth-configuration-ui/19-RESEARCH.md
@src/types/auth.ts
@src/store/authStore.ts
@src/services/api/errors.ts
@src/components/ui/input.tsx
@src/components/ui/button.tsx
@src/components/forms/ParameterForm.tsx (example of Disclosure usage)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LockIcon, AuthTypeSelector, and AuthErrorDisplay components</name>
  <files>
    src/components/auth/LockIcon.tsx
    src/components/auth/AuthTypeSelector.tsx
    src/components/auth/AuthErrorDisplay.tsx
  </files>
  <action>
Create three standalone components:

**LockIcon.tsx** — A button that displays a lock icon with three visual states:
- `none` (default): Gray lock-open icon (Lucide `LockOpen`), tooltip "No authentication configured"
- `active`: Green filled lock icon (Lucide `Lock`), tooltip shows active auth type (e.g., "Bearer Token active")
- `failed`: Red lock icon (Lucide `Lock`) with alert indicator, tooltip shows error context

Props: `{ status: AuthStatus; activeType?: AuthType | null; onClick: () => void }`. Use native `title` attribute for tooltip. Use Tailwind classes for color: `text-gray-400` (none), `text-green-600` (active), `text-red-500` (failed). Render as a button with `variant="ghost" size="icon"` from shadcn Button.

**AuthTypeSelector.tsx** — A native HTML `<select>` dropdown with options:
- "None" (value: "none") — selecting this calls `clearForApi(url)` on authStore
- "API Key" (value: "apiKey")
- "Bearer Token" (value: "bearer")
- "Basic Auth" (value: "basic")
- "Query Parameter" (value: "queryParam")

Props: `{ value: AuthType | 'none'; onChange: (type: AuthType | 'none') => void }`. Style with Tailwind to match existing form inputs (rounded border, focus ring). Use a `<label>` with "Auth Type" text above the select.

**AuthErrorDisplay.tsx** — Inline error message component for auth errors.
Props: `{ error: { status: 401 | 403; message: string } | null }`. When error is present, render:
- 401: Red-tinted box with message "Authentication required — configure credentials above"
- 403: Orange-tinted box with message "Insufficient permissions — check your credentials"

Use Tailwind for styling: `bg-red-50 border-red-200 text-red-700` for 401, `bg-orange-50 border-orange-200 text-orange-700` for 403. Include a small Lucide `AlertCircle` icon. Return null when no error.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero type errors. All three files exist and export their components.
  </verify>
  <done>
LockIcon renders three distinct visual states with correct colors and tooltips. AuthTypeSelector renders a dropdown with all 5 options. AuthErrorDisplay renders distinct 401/403 messages or null.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CredentialForm and AuthPanel components</name>
  <files>
    src/components/auth/CredentialForm.tsx
    src/components/auth/AuthPanel.tsx
  </files>
  <action>
**CredentialForm.tsx** — Dynamic form that renders different fields based on auth type:

- `bearer`: Single "Token" field (password input with eye toggle)
- `basic`: "Username" field (text) + "Password" field (password with eye toggle)
- `apiKey`: "Header Name" field (text, placeholder "X-API-Key") + "Value" field (password with eye toggle)
- `queryParam`: "Parameter Name" field (text, placeholder "api_key") + "Value" field (password with eye toggle)
- `none` or null: Render nothing (return null)

Props: `{ type: AuthType | 'none'; url: string }`.

Implementation details:
- Use shadcn `Input` component for all fields.
- Each password field has a toggle button (Lucide `Eye`/`EyeOff`) that switches between `type="password"` and `type="text"`.
- Auto-save: On every input change, construct the appropriate `Credential` object and call `useAuthStore.getState().setCredential(url, credential)`. Use the `label` field as empty string (labels are optional).
- Load initial values from `useAuthStore().getCredentials(url)` to populate fields on mount.
- Use stable component keys per auth type to avoid losing focus on re-render. Do NOT conditionally mount/unmount input elements during typing.
- Keep field values in local state, sync to store on change.

**AuthPanel.tsx** — The main container that composes all auth components into a Headless UI Disclosure.

Props: `{ url: string; isOpen: boolean; onToggle: () => void; authError?: { status: 401 | 403; message: string } | null }`.

Structure:
```
<div> (wrapper)
  <Disclosure> (controlled via isOpen prop)
    <DisclosurePanel>
      <AuthErrorDisplay error={authError} />
      <AuthTypeSelector value={currentType} onChange={handleTypeChange} />
      <CredentialForm type={currentType} url={url} />
    </DisclosurePanel>
  </Disclosure>
</div>
```

The panel reads auth state from `useAuthStore`:
- `getCredentials(url)` to determine current auth type (default to 'none' if no credentials)
- `getAuthStatus(url)` for the lock icon state

When `AuthTypeSelector` changes to 'none', call `useAuthStore.getState().clearForApi(url)`.
When type changes to a real auth type, CredentialForm handles credential creation on input.

After any credential save, call `onToggle()` to collapse the panel (auto-collapse after save per CONTEXT.md).

Use Headless UI Disclosure with a static prop or controlled open state. Wrap in a `div` with transition classes for smooth expand/collapse animation: `transition-all duration-200 ease-in-out`.
  </action>
  <verify>
Run `npx tsc --noEmit` — zero type errors. Run `npm run build` — build succeeds. Both files exist and export their components.
  </verify>
  <done>
CredentialForm renders correct fields for each auth type with masked inputs and visibility toggles. AuthPanel composes all auth components in a collapsible Disclosure that reads/writes authStore. Auto-save on input change works. Selecting "None" clears credentials.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `npm run build` succeeds
3. All 5 files exist in src/components/auth/
4. Each component exports correctly and uses proper TypeScript types from src/types/auth.ts
</verification>

<success_criteria>
All auth UI components created and type-safe. LockIcon has 3 states. AuthTypeSelector has 5 options including None. CredentialForm renders 4 different form layouts. AuthErrorDisplay shows 401/403 distinction. AuthPanel wraps everything in a collapsible Disclosure. Build passes.
</success_criteria>

<output>
After completion, create `.planning/phases/19-auth-configuration-ui/19-01-SUMMARY.md`
</output>
