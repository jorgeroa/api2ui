---
phase: 14.1-smart-object-and-primitive-selection
plan: 01
subsystem: selection
tags: [heuristics, tdd, component-selection, semantic-analysis]

# Dependency graph
requires:
  - phase: 14-smart-component-selection
    provides: Selection service foundation with array-of-objects heuristics
  - phase: 13-field-importance-and-grouping-analysis
    provides: ImportanceScore and tier classification
  - phase: 12-semantic-field-detection
    provides: SemanticMetadata and category detection

provides:
  - Object selection heuristics (profile, complex nested, split patterns)
  - Primitive array selection heuristics (chips pattern)
  - selectObjectComponent and selectPrimitiveArrayComponent public API
  - 32 comprehensive tests for object and primitive array patterns

affects: [14.1-02, useSchemaAnalysis, DynamicRenderer]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "TDD red-green-refactor cycle for heuristic development"
    - "Object field semantic analysis using $.fieldName paths"
    - "Data-driven heuristics for primitive array value analysis"

key-files:
  created: []
  modified:
    - src/services/selection/heuristics.ts
    - src/services/selection/heuristics.test.ts
    - src/services/selection/index.ts

key-decisions:
  - "Profile pattern requires name + 2+ contact fields for high confidence hero selection"
  - "Complex pattern threshold set to 3+ nested structures for tabs organization"
  - "Split pattern requires exactly 1 primary content field to avoid ambiguity"
  - "Chips pattern uses data-driven heuristics (avg length <=20, max <=30, <=10 items)"
  - "Object field semantics use $.fieldName path format (not $[].fieldName)"

patterns-established:
  - "getObjectFields helper pattern for extracting object field entries with FieldDefinition access"
  - "checkChipsPattern signature differs from object heuristics (data, schema, context) for value analysis"
  - "Semantic category iteration via context.semantics.values() for variable path matching"

# Metrics
duration: 3min
completed: 2026-02-08
---

# Phase 14.1 Plan 01: Object and Primitive Array Selection Heuristics Summary

**Four new heuristics detect profile, complex nested, split, and chips patterns with 75-90% confidence thresholds**

## Performance

- **Duration:** 3 min 37 sec
- **Started:** 2026-02-09T00:28:04Z
- **Completed:** 2026-02-09T00:31:41Z
- **Tasks:** 2 (TDD: RED → GREEN)
- **Files modified:** 3

## Accomplishments
- Object selection heuristics closed gap where all objects defaulted to "detail" component
- Primitive array heuristics closed gap where all arrays defaulted to "primitive-list" component
- Four pattern matchers with appropriate confidence thresholds (0.75-0.9)
- 32 new tests cover all edge cases and fallback scenarios
- All 66 total tests passing (34 existing + 32 new) with zero regressions

## Task Commits

Each task was committed atomically following TDD cycle:

1. **Task 1: RED - Write failing tests** - `a6c9a62` (test)
   - 6 tests for checkProfilePattern
   - 4 tests for checkComplexObjectPattern
   - 6 tests for checkSplitPattern
   - 5 tests for selectObjectComponent
   - 7 tests for checkChipsPattern
   - 4 tests for selectPrimitiveArrayComponent

2. **Task 2: GREEN - Implement heuristics** - `b442863` (feat)
   - checkProfilePattern: name + 2+ contact fields → hero (0.85)
   - checkComplexObjectPattern: 3+ nested structures → tabs (0.8)
   - checkSplitPattern: content + metadata split → split (0.75)
   - checkChipsPattern: tags/status or short values → chips (0.8-0.9)
   - selectObjectComponent and selectPrimitiveArrayComponent public API

**Plan metadata:** (pending)

_Note: No refactor phase needed - implementation clean on first pass_

## Files Created/Modified
- `src/services/selection/heuristics.ts` - Added 4 new heuristic functions and getObjectFields helper (200+ lines)
- `src/services/selection/heuristics.test.ts` - Added 32 comprehensive tests with mock helpers (600+ lines)
- `src/services/selection/index.ts` - Added selectObjectComponent and selectPrimitiveArrayComponent exports (100+ lines)

## Decisions Made

**1. Profile pattern requires 2+ contact fields**
- Rationale: Single contact field too ambiguous, could match many object types
- Threshold ensures high confidence for hero component selection

**2. Complex pattern set to 3+ nested structures**
- Rationale: 2 nested structures could be normal object nesting, 3+ indicates intentional complexity
- Tabs component better organizes 3+ nested sections

**3. Split pattern requires exactly 1 primary content field**
- Rationale: Multiple primary content fields suggest different layout (cards, tabs)
- "Exactly 1" prevents false positives on multi-content objects

**4. Chips pattern uses data-driven value length analysis**
- Rationale: Semantic categories (tags, status) give highest confidence (0.9)
- Value length heuristics (avg <=20, max <=30, <=10 items) provide fallback (0.8)
- Prevents long text arrays from incorrectly rendering as chips

**5. Object field semantic paths use $.fieldName format**
- Rationale: Array item fields use $[].fieldName, object fields use $.fieldName
- Consistent with JSON path conventions

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None - TDD approach prevented integration issues, all tests passed on first GREEN implementation.

## Next Phase Readiness

**Ready for integration:**
- selectObjectComponent and selectPrimitiveArrayComponent exported from selection service
- Functions ready to be called from useSchemaAnalysis hook or DynamicRenderer
- All fallback cases handled (non-matching schemas return appropriate defaults)

**Integration considerations:**
- Object heuristics need object schema with semantic metadata and importance scores
- Primitive array heuristics need actual data for value-based analysis (not just schema)
- Confidence threshold of 0.75 established across all smart selection (consistent with Phase 14)

**No blockers or concerns** - clean implementation with comprehensive test coverage.

---
*Phase: 14.1-smart-object-and-primitive-selection*
*Completed: 2026-02-08*
