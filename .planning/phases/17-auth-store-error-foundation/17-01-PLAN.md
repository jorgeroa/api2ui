---
phase: 17-auth-store-error-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/auth.ts
  - src/types/errors.ts
  - src/services/api/errors.ts
autonomous: true

must_haves:
  truths:
    - "AuthError type distinguishes 401 (authentication failed) from 403 (authorization denied)"
    - "AuthError carries HTTP status, auth context, and suggestion text"
    - "Existing error handling (CORSError, NetworkError, APIError, ParseError) continues working unchanged"
    - "All 4 auth types (bearer, basic, apiKey, queryParam) have type-safe credential definitions"
  artifacts:
    - path: "src/types/auth.ts"
      provides: "Credential discriminated union, AuthType, AuthStatus, ApiCredentials types"
      contains: "type Credential"
    - path: "src/types/errors.ts"
      provides: "Extended ErrorKind union with 'auth'"
      contains: "'auth'"
    - path: "src/services/api/errors.ts"
      provides: "AuthError class implementing AppError"
      exports: ["AuthError"]
  key_links:
    - from: "src/services/api/errors.ts"
      to: "src/types/errors.ts"
      via: "AuthError implements AppError with kind: 'auth'"
      pattern: "kind.*=.*'auth'"
    - from: "src/types/auth.ts"
      to: "src/types/errors.ts"
      via: "AuthStatus type references auth error states"
      pattern: "AuthStatus"
---

<objective>
Define TypeScript types for authentication credentials and the AuthError class for 401/403 handling.

Purpose: Establish the type foundation that the auth store (Plan 02), fetch integration (Phase 18), and error display (Phase 21) all depend on.
Output: `src/types/auth.ts` with credential types, extended `ErrorKind` union, and `AuthError` class.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-auth-store-error-foundation/17-CONTEXT.md
@.planning/phases/17-auth-store-error-foundation/17-RESEARCH.md
@src/types/errors.ts
@src/services/api/errors.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create auth credential types</name>
  <files>src/types/auth.ts</files>
  <action>
Create `src/types/auth.ts` with a discriminated union for credential types. Follow the CONTEXT decisions exactly:

1. Define `AuthType = 'bearer' | 'basic' | 'apiKey' | 'queryParam'`

2. Define base credential interface with shared fields:
   - `type: AuthType` (discriminant)
   - `label: string` (user-defined nickname, e.g. "Production API key")

3. Define 4 specific credential interfaces extending the base:
   - `BearerCredential`: type 'bearer', token: string
   - `BasicCredential`: type 'basic', username: string, password: string
   - `ApiKeyCredential`: type 'apiKey', headerName: string, value: string
   - `QueryParamCredential`: type 'queryParam', paramName: string, value: string

4. Define `Credential` as discriminated union of all 4 types

5. Define `AuthStatus = 'untested' | 'success' | 'failed'` for per-API auth state tracking

6. Define `ApiCredentials` interface for per-origin storage:
   - `credentials: Record<AuthType, Credential | null>` — one slot per type, null if not set
   - `activeType: AuthType | null` — which credential type is currently active

Export all types. All fields are JSON-serializable primitives (strings only) for sessionStorage compatibility.
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors in new file</verify>
  <done>All 4 credential types defined as discriminated union, AuthStatus and ApiCredentials types exported, TypeScript compiles cleanly</done>
</task>

<task type="auto">
  <name>Task 2: Extend ErrorKind and create AuthError class</name>
  <files>src/types/errors.ts, src/services/api/errors.ts</files>
  <action>
1. In `src/types/errors.ts`:
   - Add `'auth'` to the `ErrorKind` union: `export type ErrorKind = 'cors' | 'network' | 'api' | 'parse' | 'auth' | 'unknown'`
   - No other changes — AppError interface stays the same

2. In `src/services/api/errors.ts`:
   - Add `AuthError` class following the exact same pattern as existing error classes (CORSError, NetworkError, etc.)
   - `AuthError extends Error implements AppError`
   - `readonly kind: ErrorKind = 'auth'`
   - `readonly status: 401 | 403` — HTTP status code
   - `readonly authContext: string` — describes what auth was used (e.g. "Bearer token" or "none configured")
   - `readonly responseBody: string` — raw response body text for debugging
   - Constructor: `constructor(url: string, status: 401 | 403, authContext: string, responseBody: string = '')`
   - Message: `"Authentication failed for {url} ({status})"` for 401, `"Authorization denied for {url} ({status})"` for 403
   - Suggestion: For 401: `"Check your credentials. The server rejected your authentication."` For 403: `"Your credentials are valid but you lack permission for this resource."`
   - Include `Object.setPrototypeOf(this, AuthError.prototype)` for correct instanceof checks
   - Export AuthError alongside existing error classes

Ensure existing error classes (CORSError, NetworkError, APIError, ParseError) are NOT modified — only add new code.
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors. Verify existing error imports still work: `grep -r "CORSError\|NetworkError\|APIError\|ParseError" src/ --include="*.ts" --include="*.tsx"` returns same results as before.</verify>
  <done>ErrorKind includes 'auth', AuthError class exported from services/api/errors.ts, all existing error handling unchanged</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `src/types/auth.ts` exports Credential, AuthType, AuthStatus, ApiCredentials
3. `src/types/errors.ts` ErrorKind union includes 'auth'
4. `src/services/api/errors.ts` exports AuthError alongside existing errors
5. Existing error imports in `src/components/error/ErrorDisplay.tsx` and `src/services/api/fetcher.ts` still compile
</verification>

<success_criteria>
- All 4 auth credential types defined with discriminated union
- AuthError class distinguishes 401 from 403 with contextual suggestions
- Existing error handling completely unchanged
- TypeScript compiles with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/17-auth-store-error-foundation/17-01-SUMMARY.md`
</output>
