---
phase: 03-configuration-system
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/config/ConfigToggle.tsx
  - src/components/config/ConfigPanel.tsx
  - src/components/config/ThemeApplier.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Floating gear button appears in bottom-right corner on all views"
    - "Clicking gear button toggles between Configure and View mode"
    - "Badge on gear button shows count of hidden fields"
    - "Side panel slides out from right when opened in Configure mode"
    - "Side panel overlays content without pushing/shrinking it"
    - "Theme preset is applied to the page via CSS class on document element"
  artifacts:
    - path: "src/components/config/ConfigToggle.tsx"
      provides: "Floating configure/view mode toggle button with hidden field badge"
      exports: ["ConfigToggle"]
      min_lines: 30
    - path: "src/components/config/ConfigPanel.tsx"
      provides: "Slide-out side panel shell with section placeholders"
      exports: ["ConfigPanel"]
      min_lines: 40
    - path: "src/components/config/ThemeApplier.tsx"
      provides: "Applies theme class and style overrides to document element"
      exports: ["ThemeApplier"]
    - path: "src/App.tsx"
      provides: "App shell with ConfigToggle, ConfigPanel, and ThemeApplier integrated"
      contains: "ConfigToggle"
  key_links:
    - from: "src/components/config/ConfigToggle.tsx"
      to: "src/store/configStore.ts"
      via: "useConfigStore for mode and hidden count"
      pattern: "useConfigStore"
    - from: "src/components/config/ConfigPanel.tsx"
      to: "src/store/configStore.ts"
      via: "useConfigStore for panelOpen state"
      pattern: "useConfigStore"
    - from: "src/components/config/ThemeApplier.tsx"
      to: "src/store/configStore.ts"
      via: "useConfigStore for globalTheme and styleOverrides"
      pattern: "useConfigStore"
    - from: "src/App.tsx"
      to: "src/components/config/ConfigToggle.tsx"
      via: "renders ConfigToggle"
      pattern: "<ConfigToggle"
---

<objective>
Build the Configure/View mode toggle, slide-out panel shell, and theme applier, then wire them into the App shell.

Purpose: This creates the visual framework users interact with to enter configuration mode. The floating button is the entry point, the panel is the workspace for deeper settings, and the ThemeApplier connects CSS variables to the store.

Output: ConfigToggle (floating button), ConfigPanel (slide-out shell), ThemeApplier (CSS variable applicator), updated App.tsx.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-configuration-system/03-RESEARCH.md
@.planning/phases/03-configuration-system/03-CONTEXT.md
@src/App.tsx
@src/store/configStore.ts
@src/types/config.ts
@src/components/detail/DetailModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ConfigToggle, ConfigPanel, and ThemeApplier components</name>
  <files>src/components/config/ConfigToggle.tsx, src/components/config/ConfigPanel.tsx, src/components/config/ThemeApplier.tsx</files>
  <action>
**ConfigToggle.tsx** - Floating button in bottom-right corner:
- Fixed position: `fixed bottom-6 right-6 z-40`
- Gear/wrench icon (use inline SVG, no icon library) - gear icon recommended
- In View mode: neutral styling (gray bg, gear icon)
- In Configure mode: active styling (blue/primary bg, indicates active editing)
- Badge: small red/orange circle overlaid on top-right of button showing count of hidden fields (from store's fieldConfigs where visible === false). Only show badge when count > 0.
- On click: toggle mode between 'configure' and 'view'. When switching to 'configure', optionally open the panel too (first time).
- Add tooltip or aria-label: "Configure view" / "Exit configure mode"
- Visual distinction for Configure mode: add a subtle colored border/outline to the main content area when in configure mode (CSS class on a wrapper).

**ConfigPanel.tsx** - Slide-out side panel using Headless UI Dialog:
- Use `Dialog` + `Transition` from @headlessui/react (already available, see DetailModal.tsx for pattern)
- Panel slides in from the right, width w-96 (384px)
- Semi-transparent backdrop (bg-black/30)
- Panel content structure (placeholder sections for now, will be filled by Plans 03-05):
  - Header: "Configure View" title + close button (X icon)
  - Section: "Fields" (placeholder text: "Field visibility and labels")
  - Section: "Components" (placeholder text: "Component type overrides")
  - Section: "Style" (placeholder text: "Theme and styling")
  - Footer: "Reset All" button (calls resetConfig from store)
- Controlled by `panelOpen` from configStore + `togglePanel` action
- Add an "Open Panel" button in the ConfigToggle area or make gear button long-press open panel. Simpler: when in Configure mode, show a small "Settings" text/icon next to the gear button that opens the panel.

**ThemeApplier.tsx** - Invisible component that syncs store to DOM:
- Read `globalTheme` and `styleOverrides` from configStore
- `useEffect` to apply `theme-{preset}` class to `document.documentElement`
- `useEffect` to apply each style override as CSS custom property via `document.documentElement.style.setProperty(key, value)`
- Clean up old overrides when they change (remove properties no longer in overrides)
- Return null (renders nothing)

IMPORTANT: Follow the Headless UI Dialog pattern already used in DetailModal.tsx. Check that file for import style (may use v2 API with separate imports like `Dialog`, `DialogPanel`, `Transition`, etc. vs v1 combined imports). Match the existing pattern.
  </action>
  <verify>
Run `npx tsc --noEmit` - no type errors.
Run `npm run build` - build succeeds.
  </verify>
  <done>
Three components created. ConfigToggle renders fixed-position gear button with mode toggle and hidden-field badge. ConfigPanel renders slide-out Dialog with section placeholders. ThemeApplier applies theme class and CSS variables to document.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire config components into App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Update App.tsx to integrate the configuration system:

1. Import ConfigToggle, ConfigPanel, and ThemeApplier.
2. Import useConfigStore to read `mode`.
3. Add ThemeApplier as first child (renders null, just syncs CSS).
4. Add ConfigToggle as a sibling to the main content (fixed position, always visible).
5. Add ConfigPanel as a sibling (controlled by store state).
6. When in Configure mode, add a visual distinction to the content area:
   - Add a subtle top-bar or colored border indicating "Configure Mode" is active
   - Example: thin blue bar at the top with text "Configure Mode" and a "Done" button
   - Or: dashed border around the content area with blue tint

The existing layout and all current functionality must remain unchanged. Config components are additive overlays.

Do NOT modify the rendering pipeline yet (DynamicRenderer, renderers). That comes in Plans 03-04.
  </action>
  <verify>
Run `npm run dev` and visually confirm:
- Gear button appears in bottom-right
- Clicking toggles between Configure and View mode
- Visual indicator shows when in Configure mode
- Panel opens/closes with animation
Run `npm run build` to confirm production build succeeds.
  </verify>
  <done>
App.tsx renders ConfigToggle (floating button), ConfigPanel (slide-out), and ThemeApplier. Gear button toggles mode. Configure mode shows visual indicator. Panel slides in/out. All existing functionality preserved.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. Floating gear button visible on page
4. Mode toggles between configure/view
5. Panel slides out from right
6. Theme class applied to document element
7. All existing rendering still works
</verification>

<success_criteria>
- Floating gear button always visible in bottom-right corner
- Click toggles Configure/View mode with visual feedback
- Badge shows hidden field count when > 0
- Slide-out panel opens with smooth animation, overlays content
- Panel has section headers for Fields, Components, Style (placeholders)
- ThemeApplier syncs store theme to CSS variables on document element
- Existing app behavior completely unchanged in View mode
</success_criteria>

<output>
After completion, create `.planning/phases/03-configuration-system/03-02-SUMMARY.md`
</output>
