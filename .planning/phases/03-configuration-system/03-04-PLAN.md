---
phase: 03-configuration-system
plan: 04
type: execute
wave: 3
depends_on: ["03-01", "03-02"]
files_modified:
  - src/components/config/ComponentPicker.tsx
  - src/components/config/ScopeDialog.tsx
  - src/components/config/ComponentOverridePanel.tsx
  - src/components/config/ConfigPanel.tsx
  - src/components/renderers/CardListRenderer.tsx
  - src/components/renderers/ListRenderer.tsx
  - src/components/registry/ComponentRegistry.tsx
  - src/components/DynamicRenderer.tsx
autonomous: true

must_haves:
  truths:
    - "User can override component type for array fields (Table, Cards, List, Raw JSON)"
    - "Visual preview picker shows thumbnail of each component option"
    - "Override prompts: apply to just this field or all similar fields"
    - "Overridden component renders in both Configure and View mode"
    - "Panel Components section lists all overrides with option to change or revert"
  artifacts:
    - path: "src/components/config/ComponentPicker.tsx"
      provides: "Visual preview picker with thumbnails for component alternatives"
      exports: ["ComponentPicker"]
    - path: "src/components/config/ScopeDialog.tsx"
      provides: "Dialog asking apply to this field or all similar fields"
      exports: ["ScopeDialog"]
    - path: "src/components/config/ComponentOverridePanel.tsx"
      provides: "Panel section listing active component overrides"
      exports: ["ComponentOverridePanel"]
    - path: "src/components/renderers/CardListRenderer.tsx"
      provides: "Card list renderer for array of objects"
      exports: ["CardListRenderer"]
    - path: "src/components/renderers/ListRenderer.tsx"
      provides: "Simple list renderer for array of objects"
      exports: ["ListRenderer"]
    - path: "src/components/registry/ComponentRegistry.tsx"
      provides: "Registry with getComponent accepting optional override"
      contains: "override"
    - path: "src/components/DynamicRenderer.tsx"
      provides: "DynamicRenderer reads config store for component overrides"
      contains: "useConfigStore"
  key_links:
    - from: "src/components/DynamicRenderer.tsx"
      to: "src/store/configStore.ts"
      via: "reads componentType override from fieldConfigs"
      pattern: "useConfigStore|fieldConfigs"
    - from: "src/components/DynamicRenderer.tsx"
      to: "src/components/registry/ComponentRegistry.tsx"
      via: "passes override to getComponent"
      pattern: "getComponent"
    - from: "src/components/config/ComponentPicker.tsx"
      to: "src/store/configStore.ts"
      via: "setFieldComponentType action"
      pattern: "setFieldComponentType"
---

<objective>
Add component type override capability with visual preview picker and "apply to similar" scope dialog.

Purpose: This delivers CFG-03 (component type overrides), enabling users to change how array data renders - switching between Table, Cards, List, and Raw JSON views. This is the core customization feature of the configuration system.

Output: ComponentPicker (visual preview), ScopeDialog (apply scope), two new renderers (CardList, List), updated registry and DynamicRenderer to respect overrides.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-configuration-system/03-RESEARCH.md
@.planning/phases/03-configuration-system/03-CONTEXT.md
@src/store/configStore.ts
@src/types/config.ts
@src/types/components.ts
@src/types/schema.ts
@src/components/registry/ComponentRegistry.tsx
@src/components/DynamicRenderer.tsx
@src/components/renderers/TableRenderer.tsx
@src/components/config/ConfigPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CardList and List renderers, update registry</name>
  <files>src/components/renderers/CardListRenderer.tsx, src/components/renderers/ListRenderer.tsx, src/components/registry/ComponentRegistry.tsx, src/components/DynamicRenderer.tsx</files>
  <action>
**CardListRenderer.tsx** - Grid of cards for array of objects:
- Accepts RendererProps (same as TableRenderer)
- Renders array items as a responsive grid of cards: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`
- Each card: rounded border, padding, shadow-sm
- Card content: show first 4-5 fields as key-value pairs. Use smart title extraction (check name, title, label, id - same pattern as DetailModal) for card header.
- Click on card opens DetailModal (same pattern as TableRenderer)
- Handle empty array: "No data" message
- Guard against wrong schema kind

**ListRenderer.tsx** - Simple vertical list for array of objects:
- Accepts RendererProps
- Renders array items as a vertical list with dividers
- Each item: single line showing smart title + 2-3 key field values inline
- Click expands to show full detail (or opens DetailModal)
- Minimal styling: border-b between items, hover highlight

**ComponentRegistry.tsx** - Add override support:
1. Import CardListRenderer and ListRenderer
2. Add them to the registry array (they match same schemas as TableRenderer)
3. Add a new export: `getComponentByType(type: string): RendererComponent | undefined` that maps string type names to components:
   - 'table' -> TableRenderer
   - 'card-list' -> CardListRenderer
   - 'list' -> ListRenderer
   - 'json' -> JsonFallback
   - 'detail' -> DetailRenderer
   - 'primitive' -> PrimitiveRenderer
   - 'primitive-list' -> PrimitiveListRenderer
4. Update `getComponent` signature to accept optional override: `getComponent(typeSignature: TypeSignature, override?: string): RendererComponent`
   - If override is provided, use `getComponentByType(override)` first; fall back to default matching if override not found
   - If no override, use existing match logic (unchanged behavior)

**DynamicRenderer.tsx** - Read config store for overrides:
1. Import `useConfigStore` from store
2. Read `fieldConfigs` and `mode` from store
3. Look up `fieldConfigs[path]?.componentType` for the current path
4. Pass override to `getComponent(schema, override)` if it exists
5. In Configure mode: show a small component-type badge/indicator on the rendered component (e.g., "Table" tag in corner) that when clicked opens the ComponentPicker
6. PRESERVE all existing behavior: depth guard, path passing, fallback to JsonFallback

IMPORTANT: Do NOT break the existing default rendering. When no override exists in config, behavior must be identical to current. Override is purely additive.
  </action>
  <verify>
Run `npx tsc --noEmit` - no type errors.
Run `npm run build` - build succeeds.
Run `npm run test:run` - existing tests pass.
  </verify>
  <done>
CardListRenderer and ListRenderer created. Registry supports getComponentByType lookup. getComponent accepts optional override string. DynamicRenderer reads configStore for component overrides. Default rendering unchanged when no overrides exist.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ComponentPicker, ScopeDialog, and panel section</name>
  <files>src/components/config/ComponentPicker.tsx, src/components/config/ScopeDialog.tsx, src/components/config/ComponentOverridePanel.tsx, src/components/config/ConfigPanel.tsx</files>
  <action>
**ComponentPicker.tsx** - Visual preview picker for component alternatives:
- Props: `currentType: string`, `availableTypes: string[]`, `sampleData: unknown`, `sampleSchema: TypeSignature`, `onSelect: (type: string) => void`, `onClose: () => void`
- Render as a popover or small dialog near the clicked component
- Grid layout (2 columns) showing each available type as a button
- Each button contains:
  - A scaled-down preview of the component rendered with sample data: use `transform: scale(0.5)` with `origin-top-left` and `pointer-events-none` on a container with overflow-hidden and fixed height (~120px)
  - Render the actual component (TableRenderer, CardListRenderer, etc.) with sample data at small scale for live preview
  - Type name label below preview
- Currently selected type has highlighted border (ring-2 ring-blue-500)
- Available types for array-of-objects: ['table', 'card-list', 'list', 'json']
- Available types for other signatures: show only compatible types
- Determine compatible types based on schema kind: array+object items gets table/card-list/list/json; object gets detail/json; primitive gets text/json

**ScopeDialog.tsx** - "Apply to this field or all similar?" prompt:
- Props: `fieldPath: string`, `componentType: string`, `similarFields: Array<{path: string, name: string}>`, `onApplyOne: () => void`, `onApplyAll: () => void`, `onCancel: () => void`
- Use Headless UI Dialog (small modal)
- Shows: "Apply {componentType} to:" with two options:
  - "Just this field ({fieldPath})" - button
  - "All similar fields ({count} fields with same type)" - button, lists the similar field paths
- Define "similar" as: same TypeSignature kind + same items kind for arrays (per research open question #2)
- If no similar fields exist, skip dialog and apply directly

**ComponentOverridePanel.tsx** - Panel section for component overrides:
- Props: none (reads from configStore)
- Lists all active component overrides from fieldConfigs (entries where componentType is set)
- Each override row: field path, current override type, "Change" button (reopens picker), "Revert" button (clears componentType)
- If no overrides: "No component overrides. Enter Configure mode to change component types."

**ConfigPanel.tsx** - Wire Components section:
- Replace Components placeholder with ComponentOverridePanel
- Import ComponentOverridePanel and render in the Components section

IMPORTANT: For preview thumbnails, render actual components but wrap in a container with `overflow-hidden`, `h-[120px]`, `w-full`, and the inner content scaled with `transform: scale(0.5)` and `transform-origin: top left`. Use `pointer-events-none` to prevent interaction with preview content.
  </action>
  <verify>
Run `npx tsc --noEmit` - no type errors.
Run `npm run build` - build succeeds.
Verify: In Configure mode, clicking component badge opens picker. Selecting different type changes rendering. ScopeDialog appears when similar fields exist.
  </verify>
  <done>
ComponentPicker shows visual previews of component alternatives. ScopeDialog prompts for apply scope. ComponentOverridePanel lists active overrides in panel. ConfigPanel Components section is wired. Component type overrides work end-to-end.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. `npm run test:run` - existing tests pass
4. CardListRenderer renders array data as card grid
5. ListRenderer renders array data as vertical list
6. Component override changes rendering from default
7. Preview picker shows live previews at reduced scale
8. Scope dialog appears when similar fields exist
9. Panel shows active overrides with change/revert options
10. Default rendering unchanged when no overrides configured
</verification>

<success_criteria>
- Array of objects can render as Table (default), Cards, List, or Raw JSON
- Visual preview picker shows live thumbnails of each option
- "Apply to all similar fields?" dialog appears when applicable
- Overrides persist in localStorage across refresh
- Panel Components section lists all active overrides
- Reverting an override returns to default component
- No regression in existing rendering behavior
</success_criteria>

<output>
After completion, create `.planning/phases/03-configuration-system/03-04-SUMMARY.md`
</output>
