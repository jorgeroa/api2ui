---
phase: 03-configuration-system
plan: 03
type: execute
wave: 3
depends_on: ["03-01", "03-02"]
files_modified:
  - src/components/config/FieldControls.tsx
  - src/components/config/EditableLabel.tsx
  - src/components/config/FieldListPanel.tsx
  - src/components/config/ConfigPanel.tsx
  - src/components/renderers/TableRenderer.tsx
  - src/components/renderers/DetailRenderer.tsx
autonomous: true

must_haves:
  truths:
    - "In Configure mode, eye icon appears on each field for hide/show toggle"
    - "In Configure mode, field labels are click-to-edit inline"
    - "Hidden fields disappear from rendered output in View mode"
    - "Custom labels replace original field names in rendered output"
    - "Side panel Fields section shows checkbox list for bulk visibility management"
    - "Side panel Fields section shows all label mappings (original -> custom)"
  artifacts:
    - path: "src/components/config/FieldControls.tsx"
      provides: "Inline overlay controls for field hide/show and label edit"
      exports: ["FieldControls"]
    - path: "src/components/config/EditableLabel.tsx"
      provides: "Click-to-edit label with contentEditable and ARIA"
      exports: ["EditableLabel"]
    - path: "src/components/config/FieldListPanel.tsx"
      provides: "Panel section with checkbox list for visibility and label mapping view"
      exports: ["FieldListPanel"]
    - path: "src/components/renderers/TableRenderer.tsx"
      provides: "Table renderer respecting field visibility, labels, and order from config"
      contains: "useConfigStore"
    - path: "src/components/renderers/DetailRenderer.tsx"
      provides: "Detail renderer respecting field visibility, labels, and order from config"
      contains: "useConfigStore"
  key_links:
    - from: "src/components/renderers/TableRenderer.tsx"
      to: "src/store/configStore.ts"
      via: "useConfigStore to read field visibility and labels"
      pattern: "useConfigStore"
    - from: "src/components/renderers/DetailRenderer.tsx"
      to: "src/store/configStore.ts"
      via: "useConfigStore to read field visibility and labels"
      pattern: "useConfigStore"
    - from: "src/components/config/FieldControls.tsx"
      to: "src/store/configStore.ts"
      via: "toggleFieldVisibility, setFieldLabel actions"
      pattern: "toggleFieldVisibility|setFieldLabel"
    - from: "src/components/config/ConfigPanel.tsx"
      to: "src/components/config/FieldListPanel.tsx"
      via: "renders FieldListPanel in Fields section"
      pattern: "<FieldListPanel"
---

<objective>
Add field visibility controls (hide/show) and inline label editing, both as inline overlays in Configure mode and as bulk management in the side panel.

Purpose: This delivers CFG-04 (field visibility) and CFG-05 (label mapping), the most immediately useful configuration capabilities. Users can declutter their view by hiding irrelevant fields and rename cryptic API field names to human-readable labels.

Output: Inline field controls, editable labels, panel field list, updated renderers that respect config.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-configuration-system/03-RESEARCH.md
@.planning/phases/03-configuration-system/03-CONTEXT.md
@src/store/configStore.ts
@src/types/config.ts
@src/components/renderers/TableRenderer.tsx
@src/components/renderers/DetailRenderer.tsx
@src/components/config/ConfigPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create inline field controls and editable label components</name>
  <files>src/components/config/FieldControls.tsx, src/components/config/EditableLabel.tsx, src/components/config/FieldListPanel.tsx</files>
  <action>
**EditableLabel.tsx** - Click-to-edit inline label:
- Props: `value: string`, `originalName: string`, `fieldPath: string`, `onChange: (newLabel: string) => void`
- In View mode or when not editing: render as plain text span
- In Configure mode: show pencil icon on hover, click enters edit mode
- Edit mode: use contentEditable div with `role="textbox"`, `aria-label="Edit label for {fieldPath}"`, `aria-multiline="false"` (accessibility per research pitfall #6)
- Enter key commits edit, Escape key cancels (reverts to previous value)
- Blur commits edit
- Show original name in small gray text below custom label if they differ
- Keep it simple: controlled component pattern with useState for draft value

**FieldControls.tsx** - Inline overlay shown in Configure mode:
- Props: `fieldPath: string`, `fieldName: string`, `isVisible: boolean`, `customLabel: string | undefined`
- Wraps around rendered field content
- In View mode: renders children only (no overlay)
- In Configure mode: renders children + overlay controls:
  - Eye icon (toggle visibility): open eye = visible, crossed-out eye = hidden. Click calls `toggleFieldVisibility(fieldPath)`
  - When field is hidden: overlay dims the content (opacity-50) and shows "Hidden" badge
  - EditableLabel for the field name
- Position: relative wrapper with absolute-positioned controls on hover
- Use `useConfigStore` to read mode and call actions

**FieldListPanel.tsx** - Panel section for bulk field management:
- Props: `fields: Array<{ path: string, name: string }>` (list of all fields in current data)
- Shows checkbox list: each field has checkbox (checked = visible) + label showing original name and custom label if set
- Checkbox toggles call `toggleFieldVisibility(path)`
- Each row has small edit icon to inline-edit the custom label
- Show count: "N of M fields visible"
- Group by: show top-level fields first, nested fields indented (parse path depth from $ notation)

IMPORTANT: contentEditable needs `suppressContentEditableWarning` in React to avoid console warning. Use `onInput` to capture text changes (not `onChange`).
  </action>
  <verify>
Run `npx tsc --noEmit` - no type errors.
  </verify>
  <done>
EditableLabel supports click-to-edit with ARIA accessibility. FieldControls wraps fields with hide/show eye icon overlay in Configure mode. FieldListPanel shows checkbox list for bulk visibility management.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update renderers to respect field config and wire panel</name>
  <files>src/components/renderers/TableRenderer.tsx, src/components/renderers/DetailRenderer.tsx, src/components/config/ConfigPanel.tsx</files>
  <action>
**TableRenderer.tsx** - Add config awareness:
1. Import `useConfigStore` from store
2. Read `mode` and `fieldConfigs` from store
3. Filter columns: in View mode, exclude fields where `fieldConfigs[path]?.visible === false`. In Configure mode, show all fields but dim hidden ones.
4. Apply custom labels: if `fieldConfigs[path]?.label` exists, use it instead of the auto-formatted column header
5. Apply field ordering: sort columns by `fieldConfigs[path]?.order` if set, otherwise maintain original order. Use stable sort (preserve original order for fields with same/no order value).
6. In Configure mode: wrap each column header with FieldControls for inline edit. Wrap using the path convention `$.fieldName` for top-level fields in the array items.
7. PRESERVE all existing functionality: click-to-detail, striped rows, CompactValue, DetailModal, scrolling.

**DetailRenderer.tsx** - Add config awareness:
1. Import `useConfigStore` from store
2. Same pattern: filter hidden fields in View mode, dim in Configure mode
3. Apply custom labels to field names
4. Apply field ordering (sort fields array)
5. In Configure mode: wrap each field row with FieldControls
6. Use path convention: `${path}.${fieldName}` matching existing path notation
7. PRESERVE all existing functionality: collapsible disclosures, nested rendering, ChevronIcon.

**ConfigPanel.tsx** - Replace Fields placeholder with FieldListPanel:
1. Import FieldListPanel
2. Import `useAppStore` to access current `schema` (to enumerate fields)
3. In the "Fields" section, render FieldListPanel with the current data's field list
4. Extract field list from schema.rootType: if array of objects, list the item fields; if object, list the fields directly
5. Keep Components and Style sections as placeholders (filled in Plans 04-05)

IMPORTANT: The path used for field config keys MUST match between renderers and the panel. Use consistent path notation: `$.fieldName` for root-level object fields, `$[].fieldName` for array item fields.
  </action>
  <verify>
Run `npx tsc --noEmit` - no type errors.
Run `npm run build` - build succeeds.
Run `npm run test:run` - existing tests still pass (TableRenderer and DetailRenderer tests if any).
Verify manually: load an API, enter Configure mode, eye icon toggles work, labels are editable, View mode hides configured fields.
  </verify>
  <done>
TableRenderer and DetailRenderer respect field visibility, custom labels, and ordering from configStore. Configure mode shows inline FieldControls overlay. ConfigPanel Fields section renders FieldListPanel with current schema fields. All existing rendering behavior preserved in View mode.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
3. `npm run test:run` - existing tests pass
4. Eye icon toggles field visibility in Configure mode
5. Hidden fields disappear in View mode
6. Click-to-edit labels work with Enter/Escape/Blur
7. Custom labels appear in both renderers
8. Panel Fields section shows checkbox list matching rendered fields
9. Field config persists in localStorage across page refresh
</verification>

<success_criteria>
- In Configure mode: eye icons on every field, click toggles visibility
- In Configure mode: labels are click-to-edit inline
- In View mode: hidden fields are invisible, custom labels displayed
- Panel Fields section: checkbox list with visibility toggles and label editing
- Config changes persist in localStorage (refresh preserves hidden fields and custom labels)
- All existing rendering behavior unchanged when no config overrides exist
</success_criteria>

<output>
After completion, create `.planning/phases/03-configuration-system/03-03-SUMMARY.md`
</output>
